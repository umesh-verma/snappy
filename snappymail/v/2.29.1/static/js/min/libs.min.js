(e=>{Array.prototype.unique=function(){return this.filter(((e,t,n)=>n.indexOf(e)===t))},Array.prototype.validUnique=function(e){return this.filter(((t,n,a)=>(e?e(t):t)&&a.indexOf(t)===n))};let t={LT:{hour:"numeric",minute:"numeric"},LLL:{dateStyle:"long",timeStyle:"short"}};Date.prototype.format=function(n,a,o){"string"==typeof n&&(n=t[n]?t[n]:{}),o&&(n.hourCycle=o);let i=e.documentElement;return this.toLocaleString(i.dataset.dateLang||i.lang,n)},Element.prototype.closestWithin=function(e,t){const n=this.closest(e);return n&&n!==t&&t.contains(n)?n:null},Element.fromHTML=t=>{const n=e.createElement("template");return n.innerHTML=t.trim(),n.content.firstChild},Function.prototype.debounce||(Function.prototype.debounce=function(e){let t,n=this;return function(...a){t&&clearTimeout(t),t=setTimeout((()=>{n.apply(this,a),t=0}),e)}}),Function.prototype.throttle||(Function.prototype.throttle=function(e){let t,n=this;return function(...a){t=t||setTimeout((()=>{n.apply(this,a),t=0}),e)}})})(document),(e=>{let t=navigator.userAgent.toLowerCase();if(t.includes("mobile")&&t.includes("gecko/")){let t,n,a,o,i,r,s,l,c={passive:!1,capture:!1},h="move",u="all",f={};class DataTransfer{get dropEffect(){return h}set dropEffect(e){h=e}get effectAllowed(){return u}set effectAllowed(e){u=e}get files(){return[]}get items(){return[]}get types(){return Object.keys(f)}clearData(e){null!=e?delete f[e]:f={}}getData(e){return f[e]||""}setData(e,t){f[e]=t}constructor(){this.setDragImage=g}}const p=t=>e.documentElement.classList.toggle("firefox-drag",t),g=(e,t,n)=>{l?.remove(),e&&(l=e.cloneNode(!0),N(e,l),l._x=null==t?e.clientWidth/2:t,l._y=null==n?e.clientHeight/2:n)},m=()=>{n&&(clearInterval(s),l?.remove(),a&&C(r,"dragend",n),l=n=r=i=t=s=null,a=o=!1,p(!1))},v=e=>({x:(e=e.touches?e.touches[0]:e).clientX,y:e.clientY}),y=e=>{n&&(o&&"touchcancel"!==e.type&&C(r,"drop",i),m())},S=t=>{let n=e.elementFromPoint(t.x,t.y);for(;n&&"none"==getComputedStyle(n).pointerEvents;)n=n.parentElement;return n},E=e=>{requestAnimationFrame((()=>{l&&(l.style.left=Math.round(e.x-l._x)+"px",l.style.top=Math.round(e.y-l._y)+"px")}))},N=(e,t)=>{if(["id","class","style","draggable"].forEach((e=>t.removeAttribute(e))),e instanceof HTMLCanvasElement){let n=e,a=t;a.width=n.width,a.height=n.height,a.getContext("2d").drawImage(n,0,0)}let n=getComputedStyle(e);Object.entries(n).forEach((([e,n])=>e.includes("transition")||(t.style[e]=n))),t.style.pointerEvents="none";let a=e.children.length;for(;a--;)N(e.children[a],t.children[a])},C=(e,a,o)=>{if(e&&o){let i=new Event(a,{bubbles:!0,cancelable:!0});i.button=0,i.buttons=1,["altKey","ctrlKey","metaKey","shiftKey"].forEach((t=>i[t]=e[t]));let r=e.touches?e.touches[0]:e;return["pageX","pageY","clientX","clientY","screenX","screenY","offsetX","offsetY"].forEach((e=>i[e]=r[e])),n&&(i.dataTransfer=t),o.dispatchEvent(i)}return!1};e.addEventListener("touchstart",(o=>{m(),o&&!o.defaultPrevented&&o.touches&&o.touches.length<2&&(n=o.target.closest("[draggable]"),n&&(r=o,s=setTimeout((()=>{if(t=new DataTransfer,a=C(o,"dragstart",n)){p(!0);let t=v(o);l||g(n);let a=l.style;a.top=a.left="-9999px",a.position="fixed",a.pointerEvents="none",a.zIndex="999999999",E(t),e.body.append(l),C(o,"dragenter",S(t))}else m()}),1e3)))}),c),e.addEventListener("touchmove",(e=>{if(a){let t=v(e),n=S(t);r=e,n!=i&&(C(e,"dragleave",i),C(e,"dragenter",n),i=n),E(t),o=!C(e,"dragover",n)}else m()}),c),e.addEventListener("touchend",y),e.addEventListener("touchcancel",y)}})(document),(e=>{let t={},n="all";const a=document,o=/Mac OS X/.test(navigator.userAgent)?"meta":"ctrl",i={all:{}},r=e=>Array.isArray(e)?e:e.split(/\s*,\s*/),s=(e,t)=>{try{e.defaultPrevented||!1!==t(e)||(e.preventDefault(),e.stopPropagation())}catch(e){}},l={on:()=>a.addEventListener("keydown",c),off:()=>a.removeEventListener("keydown",c),add:(e,t,n,a)=>{null==a&&(a=n,n="all"),r(n).forEach((n=>{i[n]||(i[n]={}),r(e).forEach((e=>{e=e.toLowerCase(),i[n][e]||(i[n][e]={}),t=r(t).map((e=>"meta"==e?o:e)).unique().sort().join("+"),i[n][e][t]||(i[n][e][t]=[]),i[n][e][t].push(a)}))}))},setScope:e=>{n=e||"all",t=i[n]||{}},getScope:()=>n,getMetaKey:()=>"meta"===o?"⌘":"Ctrl"},c=e=>{let a=(e.key||"").toLowerCase().replace(" ","space"),o=["alt","ctrl","meta","shift"].filter((t=>e[t+"Key"])).join("+");t[a]?.[o]?.forEach((t=>s(e,t))),!e.defaultPrevented&&"all"!==n&&i.all[a]?.[o]?.forEach((t=>s(e,t)))};e.shortcuts=l,l.on()})(this),(e=>{const t=/#(.*)$/,n=/^[#/]+/,a=/^\/+/g,o=e=>e?.replace(a,"")||"",i=()=>{var e=t.exec(location.href);return e?.[1]?decodeURIComponent(e[1]):""},r=e=>{if(h!==e){var t=h;h=e,l(o(e),o(t))}},s=(e,t)=>{(e=e?"/"+e.replace(n,""):e)!==h&&(r(e),e===h&&(e="#"+encodeURI(e),t?location.replace(e):location.hash=e))},l=(...e)=>c.active&&u.forEach((t=>t(...e))),c={clear:()=>{u=[],c.active=!0},active:!0,add:e=>u.push(e),init:()=>l(o(h)),setHash:e=>s(e),replaceHash:e=>s(e,!0)};var h=i(),u=[];addEventListener("hashchange",(()=>r(i()))),e.hasher=c})(this),(e=>{const t=e=>"function"==typeof e;this.Crossroads=class Crossroads{constructor(){this._routes=[]}addRoute(e,t){var n=new Route(e,t,this);return this._routes.push(n),n}parse(e){e=e||"";for(var t,n=0,a=this._routes,o=a.length;o--;)t=a[o],n&&!t.greedy||!t.match(e)||(t.callback?.(...t._getParamsArray(e)),++n)}};class Route{constructor(e,n,a){var o=e instanceof RegExp;Object.assign(this,{greedy:!1,rules:{},_router:a,_pattern:e,_paramsIds:o?null:y(l,e),_optionalParamsIds:o?null:y(s,e),_matchRegexp:o?e:E(e),callback:t(n)?n:null})}match(e){var n=this._getParamsObject(e);return this._matchRegexp.test(e)&&0==Object.entries(this.rules).filter((([a,o])=>{var i=n[a],r=!1;return"normalize_"===a||null==i&&this._optionalParamsIds?.includes(a)?r=!0:o instanceof RegExp?r=o.test(i):Array.isArray(o)?r=o.includes(i):t(o)&&(r=o(i,e,n)),!r})).length}_getParamsObject(e){var t=S(e,this._matchRegexp)||[],n=t.length;if(this._paramsIds)for(;n--;)t[this._paramsIds[n]]=t[n];return t}_getParamsArray(e){var n=this.rules.normalize_;return t(n)?n(e,this._getParamsObject(e)):S(e,this._matchRegexp)}}const n=/[\\.+*?^$[\](){}/'#]/g,a=/\/$/g,o=/([:}]|\w(?=\/))\/?(:)/g,i=/([:}])\/?(\{)/g,r=/\{([^}]+)\}/g,s=/:([^:]+):/g,l=/(?:\{|:)([^}:]+)(?:\}|:)/g,c="__CR_RP__",h="__CR_OP__",u="__CR_RS__",f="__CR_OS__",p=new RegExp(c,"g"),g=new RegExp(h,"g"),m=new RegExp(f,"g"),v=new RegExp(u,"g"),y=(e,t)=>{for(var n,a=[];n=e.exec(t);)a.push(n[1]);return a},S=(e,t)=>{var n=t.exec(e);return n?.shift(),n},E=e=>new RegExp("^"+(e?e.replace(a,"").replace(o,"$1"+f+"$2").replace(i,"$1"+u+"$2").replace(s,h).replace(r,c).replace(n,"\\$&").replace(m,"\\/?").replace(v,"\\/").replace(g,"([^\\/]+)?/?").replace(p,"([^\\/]+)"):"")+"/?$")})(),(e=>{const t=e=>void 0!==e,n=(e,t,n)=>{if(e?.length){let o,i=0,r=!1;[...e].forEach((e=>{e&&(n&&n<++i?r||(r=!0):(o=a(e),o&&t(o)))}))}},a=e=>e.size?{fileName:(e.name||"").replace(/^.*\/([^/]*)$/,"$1"),size:e.size,file:e}:null,o=e=>e.dataTransfer.types.includes("Files");class Queue extends Array{push(e,...t){super.push([e,t]),this.call()}call(){if(!this.running){let e;for(this.running=!0;e=this.shift();)e[0](...e[1]);this.running=!1}}}class Jua{constructor(t){let a,i=t.clickElement;const r=this,s=()=>{a&&clearTimeout(a),a=0};var l,c;r.oEvents={onSelect:null,onStart:null,onComplete:null,onProgress:null,onDragEnter:null,onDragLeave:null,onBodyDragEnter:null,onBodyDragLeave:null},r.oXhrs={},r.oUids={},r.options=Object.assign({action:"",name:"uploader",limit:0},t||{}),r.oQueue=new Queue,i&&(i.style.position="relative",i.style.overflow="hidden","inline"===i.style.display&&(i.style.display="inline-block"),r.generateNewInput(i)),i=t.dragAndDropElement,i&&(l=e,c={dragover:e=>{o(e)&&(s(),i.contains(e.target)?(e.dataTransfer.dropEffect="copy",e.stopPropagation()):e.dataTransfer.dropEffect="none",e.preventDefault())},dragenter:e=>{o(e)&&(s(),e.preventDefault(),r.runEvent("onBodyDragEnter",e),i.contains(e.target)&&(s(),r.runEvent("onDragEnter",i,e)))},dragleave:t=>{if(o(t)){let o=e.elementFromPoint(t.clientX,t.clientY);o&&i.contains(o)||r.runEvent("onDragLeave",i,t),n=()=>r.runEvent("onBodyDragLeave",t),s(),a=setTimeout(n,200)}var n},drop:e=>{o(e)&&(s(),e.preventDefault(),i.contains(e.target)&&n(e.files||e.dataTransfer.files,(e=>{e&&r.addFile(e)}),r.options.limit)),r.runEvent("onDragLeave",e),r.runEvent("onBodyDragLeave",e)}},Object.entries(c).forEach((([e,t])=>l.addEventListener(e,t))))}on(e,t){return this.oEvents[e]=t,this}runEvent(e,...t){this.oEvents[e]?.apply(null,t)}getEvent(e){return this.oEvents[e]||null}addFile(e){const t="jua-uid-"+Jua.randomId(16)+"-"+Date.now().toString(),n=this.getEvent("onSelect");!e||n&&!1===n(t,e)?this.cancel(t):(this.oUids[t]=!0,this.oQueue.push(((...e)=>this.uploadTask(...e)),t,e))}uploadTask(e,n){if(!1===this.oUids[e]||!n||!n.file)return!1;try{const a=this,o=new XMLHttpRequest,i=new FormData,r=this.options.action,s=this.getEvent("onStart"),l=this.getEvent("onProgress");return o.open("POST",r,!0),l&&o.upload&&(o.upload.onprogress=n=>{n&&n.lengthComputable&&t(n.loaded)&&t(n.total)&&l(e,n.loaded,n.total)}),o.onreadystatechange=()=>{if(4===o.readyState){delete a.oXhrs[e];let t=!1,n=null;if(200===o.status)try{n=JSON.parse(o.responseText),t=!0}catch(e){}this.getEvent("onComplete")(e,t,n)}},s&&s(e),i.append(this.options.name,n.file),o.send(i),this.oXhrs[e]=o,!0}catch(e){}return!1}generateNewInput(t){if(t){const a=this,o=a.options.limit,i=e.createElement("input"),r=()=>i.click();i.type="file",i.tabIndex=-1,i.style.display="none",i.multiple=1!=o,t.addEventListener("click",r),i.addEventListener("input",(()=>{const e=e=>{a.addFile(e),setTimeout((()=>{i.remove(),t.removeEventListener("click",r),a.generateNewInput(t)}),10)};i.files?.length?n(i.files,e,o):e({fileName:i.value.split(/\\\//).pop(),size:null,file:null})}))}}cancel(e){if(this.oUids[e]=!1,this.oXhrs[e]){try{this.oXhrs[e].abort&&this.oXhrs[e].abort()}catch(e){}delete this.oXhrs[e]}}}Jua.randomId=e=>{let t=new Uint8Array((e||32)/2);return crypto.getRandomValues(t),t.map((e=>e.toString(16).padStart(2,"0"))).join("")},this.Jua=Jua})(document),(e=>{const t=e=>e.focus?e.focus():e.setActive(),n=e=>"ArrowUp"===e.key||"ArrowDown"===e.key;this.BSN={Dropdown:function(a){let o,i=[];const r=this,s=a.parentNode,l=e=>{const t=e.target;"#"===(t.href||t.parentNode?.href)?.slice(-1)&&e.preventDefault()},c=e=>{o?.classList.toggle("show",e),s.classList.toggle("show",e),a.setAttribute("aria-expanded",e),a.open=e,e?a.removeEventListener("click",f):setTimeout((()=>a.addEventListener("click",f)),1)},h=()=>{const t=(a.open?"add":"remove")+"EventListener";e[t]("click",u),e[t]("keydown",p),e[t]("keyup",g),e[t]("focus",u)},u=e=>{const t=e.target;(o.contains(t)||a.contains(t))&&"focus"===e.type||(r.hide(),l(e))},f=e=>{r.show(),l(e)},p=e=>n(e)&&e.preventDefault(),g=o=>{if("Escape"===o.key)r.toggle();else if(n(o)){let n=e.activeElement,r=n===a,l=r?0:i.indexOf(n);s.contains(n)&&(r||(l="ArrowUp"===o.key?l>1?l-1:0:l<i.length-1?l+1:l),i[l]&&t(i[l]))}};r.show=()=>{o=s.querySelector(".dropdown-menu"),i=[...o.querySelectorAll("A")].filter((e=>"none"!=e.parentNode.style.display)),!("tabindex"in o)&&o.setAttribute("tabindex","0"),c(!0),setTimeout((()=>{t(o.getElementsByTagName("INPUT")[0]||a),h()}),1)},r.hide=()=>{c(!1),h(),t(a)},r.toggle=()=>a.open?r.hide():r.show(),c(!1),a.Dropdown=r}}})(document),(e=>{function t(e,t){return!(null!==e&&!p[typeof e])&&e===t}function n(e,t){var n;return()=>{n||(n=setTimeout((()=>{n=0,e()}),t))}}function a(e,t){t?.A?.()}function o(e,t){var n=this.$b,a=n[C];a.$||(this.Za&&this.za[t]?(n.vb(t,e,this.za[t]),this.za[t]=null,--this.Za):a.B[t]||n.vb(t,e,a.C?{X:e}:n.Sb(e)),e.ja&&e.Wb())}function i(e){e=f.g.j.get(e,D);var t=e?.I;t&&(e.I=null,t.Mb())}function r(e,t){for(var n,a=f.m.firstChild(t);n=a;)a=f.m.nextSibling(n),s(e,n);f.l.notify(t,f.l.H)}function s(e,t){var n=e;(1===t.nodeType||f.Ab.nc(t))&&(n=l(t,null,e).bindingContextForDescendants),n&&!t.matches?.("SCRIPT,TEXTAREA,TEMPLATE")&&r(n,t)}function l(e,t,n){var a=f.g.j.fb(e,D,{}),o=a.Xb;if(!t){if(o)throw Error("You cannot apply bindings multiple times to the same element.");a.Xb=!0}if(o||(a.context=n),a.hb||(a.hb={}),t&&"function"!=typeof t)var i=t;else{var r=f.u((()=>((i=t?t(n,e):f.Ab.cc(e,n))&&(n[k]?.(),n[A]?.()),i)),{s:e});i&&r.isActive()||(r=null)}var s,l=n;if(i){var c=r?e=>()=>r()[e]():e=>i[e],h={get:e=>i[e]&&c(e)(),has:e=>e in i};f.l.H in i&&f.l.subscribe(e,f.l.H,(()=>{var t=i[f.l.H]();if(t){var n=f.m.childNodes(e);n.length&&t(n,f.Eb(n[0]))}})),f.l.ga in i&&(l=f.l.mb(e,n),f.l.subscribe(e,f.l.ga,(()=>{var t=i[f.l.ga]();t&&f.m.firstChild(e)&&t(e)}))),function(e){var t=[],n={},a=[];return f.g.P(e,(function o(i){if(!n[i]){var r=f.h[i];r&&(r.after&&(a.push(i),r.after.forEach((t=>{if(e[t]){if(a.includes(t))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+a.join(", "));o(t)}})),a.length--),t.push({key:i,Ib:r})),n[i]=!0}})),t}(i).forEach((t=>{var n=t.Ib.init,a=t.Ib.update,o=t.key;if(8===e.nodeType&&!f.m.ca[o])throw Error("The binding '"+o+"' cannot be used with virtual elements");try{"function"==typeof n&&f.o.M((()=>{var t=n(e,c(o),h,l.$data,l);if(t&&t.controlsDescendantBindings){if(void 0!==s)throw Error("Multiple bindings ("+s+" and "+o+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");s=o}})),"function"==typeof a&&f.u((()=>a(e,c(o),h,l.$data,l)),{s:e})}catch(e){throw e.message='Unable to process binding "'+o+": "+i[o]+'"\nMessage: '+e.message,e}}))}return{shouldBindDescendants:a=void 0===s,bindingContextForDescendants:a&&l}}function c(e,t){return e&&e instanceof f.ea?e:new f.ea(e,void 0,void 0,t)}var h=e.document,u={},f=void 0!==u?u:{};f.v=(e,t)=>{e=e.split(".");for(var n=f,a=0,o=e.length-1;a<o;a++)n=n[e[a]];n[e[o]]=t},f.ha=(e,t,n)=>{e[t]=n},f.v("version","3.5.1-sm"),f.g={extend:(e,t)=>t?Object.assign(e,t):e,P:(e,t)=>e&&Object.entries(e).forEach((e=>t(e[0],e[1]))),cb:e=>[...e.childNodes].forEach((e=>f.removeNode(e))),Lb:e=>{e=[...e];var t=(e[0]?.ownerDocument||h).createElement("div");return e.forEach((e=>t.append(f.fa(e)))),t},ya:(e,t)=>Array.prototype.map.call(e,t?e=>f.fa(e.cloneNode(!0)):e=>e.cloneNode(!0)),ua:(e,t)=>{f.g.cb(e),t&&e.append(...t)},Ba:(e,t)=>{if(e.length){for(t=8===t.nodeType&&t.parentNode||t;e.length&&e[0].parentNode!==t;)e.splice(0,1);for(;1<e.length&&e[e.length-1].parentNode!==t;)--e.length;if(1<e.length){t=e[0];var n=e[e.length-1];for(e.length=0;t!==n;)e.push(t),t=t.nextSibling;e.push(n)}}return e},Rb:e=>null==e?"":e.trim?e.trim():e.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,""),bb:e=>e.ownerDocument.documentElement.contains(1!==e.nodeType?e.parentNode:e),Tb:(e,t)=>{if(!e?.nodeType)throw Error("element must be a DOM node when calling triggerEvent");e.dispatchEvent(new Event(t))},i:e=>f.T(e)?e():e,lb:(e,t)=>e.textContent=f.g.i(t)||""},f.v("utils",f.g),f.v("unwrap",f.g.i),(()=>{let e=0,t="__ko__"+Date.now(),n=new WeakMap;f.g.j={get:(e,t)=>(n.get(e)||{})[t],set:(e,t,a)=>(n.has(e)?n.get(e)[t]=a:n.set(e,{[t]:a}),a),fb:function(e,t,n){return this.get(e,t)||this.set(e,t,n)},clear:e=>n.delete(e),Z:()=>e+++t}})(),f.g.K=(()=>{var e=f.g.j.Z(),t={1:1,8:1,9:1},n={1:1,9:1};const a=(t,n)=>{var a=f.g.j.get(t,e);return n&&!a&&(a=new Set,f.g.j.set(t,e,a)),a},o=e=>{var t=a(e);t&&new Set(t).forEach((t=>t(e))),f.g.j.clear(e),n[e.nodeType]&&i(e.childNodes,!0)},i=(e,t)=>{for(var n,a=[],i=0;i<e.length;i++)if((!t||8===e[i].nodeType)&&(o(a[a.length]=n=e[i]),e[i]!==n))for(;i--&&!a.includes(e[i]););};return{ma:(e,t)=>{if("function"!=typeof t)throw Error("Callback must be a function");a(e,1).add(t)},kb:(t,n)=>{var o=a(t);o&&(o.delete(n),o.size||f.g.j.set(t,e,null))},fa:e=>(f.o.M((()=>{t[e.nodeType]&&(o(e),n[e.nodeType]&&i(e.getElementsByTagName("*")))})),e),removeNode:e=>{f.fa(e),e.parentNode&&e.parentNode.removeChild(e)}}})(),f.fa=f.g.K.fa,f.removeNode=f.g.K.removeNode,f.v("utils.domNodeDisposal",f.g.K),f.v("utils.domNodeDisposal.addDisposeCallback",f.g.K.ma),f.eb={debounce:(e,t)=>e.Ja((e=>function(e,t){var n;return()=>{clearTimeout(n),n=setTimeout(e,t)}}(e,t))),rateLimit:(e,t)=>{if("number"==typeof t)var a=t;else{a=t.timeout;var o=t.method}var i="function"==typeof o?o:n;e.Ja((e=>i(e,a,t)))},notify:(e,n)=>{e.pa="always"==n?null:t}};var p={undefined:1,boolean:1,number:1,string:1};f.v("extenders",f.eb);class ka{constructor(e,t,n){this.X=e,this.pb=t,this.Da=n,this.Ra=!1,this.L=this.ia=null,f.ha(this,"dispose",this.A)}A(){this.Ra||(this.L&&f.g.K.kb(this.ia,this.L),this.Ra=!0,this.Da(),this.X=this.pb=this.Da=this.ia=this.L=null)}s(e){this.ia=e,f.g.K.ma(e,this.L=this.A.bind(this))}}f.V=function(){Object.setPrototypeOf(this,y),y.Fa(this)};var g,m,v,y={Fa:e=>{e.W=new Map,e.W.set("change",new Set),e.ub=1},subscribe:function(e,t,n){var a=this;n=n||"change";var o=new ka(a,t?e.bind(t):e,(()=>{a.W.get(n).delete(o),a.Sa?.(n)}));return a.Ua?.(n),a.W.has(n)||a.W.set(n,new Set),a.W.get(n).add(o),o},D:function(e,t){if("change"===(t=t||"change")&&this.Na(),this.ra(t)){t="change"===t&&this.Ub||new Set(this.W.get(t));try{f.o.zb(),t.forEach((t=>{t.Ra||t.pb(e)}))}finally{f.o.end()}}},Ca:function(){return this.ub},fc:function(e){return this.Ca()!==e},Na:function(){++this.ub},Ja:function(e){var t,n,a,o,i,r=this,s=f.T(r);r.wa||(r.wa=r.D,r.D=(e,t)=>{t&&"change"!==t?"beforeChange"===t?r.rb(e):r.wa(e,t):r.sb(e)});var l=e((()=>{r.ja=!1,s&&o===r&&(o=r.qb?r.qb():r());var e=n||i&&r.Ha(a,o);i=n=t=!1,e&&r.wa(a=o)}));r.sb=(e,n)=>{n&&r.ja||(i=!n),r.Ub=new Set(r.W.get("change")),r.ja=t=!0,o=e,l()},r.rb=e=>{t||(a=e,r.wa(e,"beforeChange"))},r.tb=()=>{i=!0},r.Wb=()=>{r.Ha(a,r.R(!0))&&(n=!0)}},ra:function(e){return(this.W.get(e)||[]).size},Ha:function(e,t){return!this.pa||!this.pa(e,t)},toString:()=>"[object Object]",extend:function(e){var t=this;return e&&f.g.P(e,((e,n)=>{"function"==typeof(e=f.eb[e])&&(t=e(t,n)||t)})),t}};f.ha(y,"init",y.Fa),f.ha(y,"subscribe",y.subscribe),f.ha(y,"extend",y.extend),f.V.fn=Object.setPrototypeOf(y,Function.prototype),f.kc=e=>"function"==typeof e?.subscribe&&"function"==typeof e.D,m=[],v=0,f.o={zb:e=>{m.push(g),g=e},end:()=>g=m.pop(),Pb:e=>{if(g){if(!f.kc(e))throw Error("Only subscribable things can act as dependencies");g.Yb.call(g.Zb,e,e.Vb||(e.Vb=++v))}},M:(e,t,n)=>{try{return m.push(g),g=void 0,e.apply(t,n||[])}finally{g=m.pop()}},qa:()=>g?.u.qa(),Ia:()=>g?.Ia,u:()=>g?.u};const S=Symbol("_latestValue");f.ba=e=>{function t(){return 0<arguments.length?(t.Ha(t[S],arguments[0])&&(t.ob(),t[S]=arguments[0],t.Oa()),this):(f.o.Pb(t),t[S])}return t[S]=e,Object.defineProperty(t,"length",{get:()=>null==t[S]?void 0:t[S].length}),f.V.fn.Fa(t),Object.setPrototypeOf(t,E)};var E={toJSON:function(){let e=this[S];return e?.toJSON?.()||e},pa:t,R:function(){return this[S]},Oa:function(){this.D(this[S],"spectate"),this.D(this[S])},ob:function(){this.D(this[S],"beforeChange")}};Object.setPrototypeOf(E,f.V.fn);var N=f.ba.qc="__ko_proto__";E[N]=f.ba,f.T=e=>{if((e="function"==typeof e&&e[N])&&e!==E[N]&&e!==f.u.fn[N])throw Error("Invalid object that looks like an observable; possibly from another Knockout instance");return!!e},f.lc=e=>"function"==typeof e&&(e[N]===E[N]||e[N]===f.u.fn[N]&&e.hc),f.v("observable",f.ba),f.v("isObservable",f.T),f.v("observable.fn",E),f.ha(E,"valueHasMutated",E.Oa),f.ta=e=>{if("object"!=typeof(e=e||[])||!("length"in e))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return Object.setPrototypeOf(f.ba(e),f.ta.fn).extend({trackArrayChanges:!0})},f.ta.fn=Object.setPrototypeOf({remove:function(e){for(var t=this.R(),n=!1,a="function"!=typeof e||f.T(e)?t=>t===e:e,o=t.length;o--;){var i=t[o];if(a(i)){if(t[o]!==i)throw Error("Array modified during remove; cannot remove item");n||this.ob(),n=!0,t.splice(o,1)}}n&&this.Oa()}},f.ba.fn),Object.getOwnPropertyNames(Array.prototype).forEach((e=>{"function"==typeof Array.prototype[e]&&"constructor"!=e&&("copyWithin fill pop push reverse shift sort splice unshift".split(" ").includes(e)?f.ta.fn[e]=function(...t){var n=this.R();return this.ob(),this.Bb(n,e,t),t=n[e](...t),this.Oa(),t===n?this:t}:f.ta.fn[e]=function(...t){return this()[e](...t)})})),f.Jb=e=>f.T(e)&&"function"==typeof e.remove&&"function"==typeof e.push,f.v("observableArray",f.ta),f.v("isObservableArray",f.Jb),f.eb.trackArrayChanges=(e,t)=>{if(e.Wa={},"object"==typeof t&&f.g.extend(e.Wa,t),e.Wa.sparse=!0,!e.Bb){var n,a,o,i=!1,r=null,s=0,l=e.Ua,c=e.Sa;e.Ua=t=>{l?.call(e,t),"arrayChange"===t&&function(){function t(){if(s){var t=[].concat(e.R()||[]);if(e.ra("arrayChange")){(!r||1<s)&&(r=f.g.Cb(o,t,e.Wa));var n=r}o=t,r=null,s=0,n?.length&&e.D(n,"arrayChange")}}i?t():(i=!0,a=e.subscribe((()=>++s),null,"spectate"),o=[].concat(e.R()||[]),r=null,n=e.subscribe(t))}()},e.Sa=t=>{c?.call(e,t),"arrayChange"!==t||e.ra("arrayChange")||(n?.A(),a?.A(),a=n=null,i=!1,o=void 0)},e.Bb=(e,t,n)=>{function a(e,t,n){return o[o.length]={status:e,value:t,index:n}}if(i&&!s){var o=[],l=e.length,c=n.length,h=0;switch(t){case"push":h=l;case"unshift":for(e=0;e<c;e++)a("added",n[e],h+e);break;case"pop":h=l-1;case"shift":l&&a("deleted",e[h],h);break;case"splice":h=Math.min(Math.max(0,0>n[0]?l+n[0]:n[0]),l),l=1===c?l:Math.min(h+(n[1]||0),l),c=h+c-2,t=Math.max(l,c);for(var u=[],p=[],g=2;h<t;++h,++g)h<l&&p.push(a("deleted",e[h],h)),h<c&&u.push(a("added",n[g],h));f.g.Hb(p,u);break;default:return}r=o}}}};var C=Symbol("_state");f.u=(e,t)=>{function n(){if(0<arguments.length){if("function"!=typeof a)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return a(...arguments),this}return o.$||f.o.Pb(n),(o.Y||o.C&&n.sa())&&n.U(),o.N}if("object"==typeof e?t=e:(t=t||{},e&&(t.read=e)),"function"!=typeof t.read)throw Error("Pass a function that returns the value of the ko.computed");var a=t.write,o={N:void 0,aa:!0,Y:!0,Ga:!1,nb:!1,$:!1,jb:!1,C:!1,Ob:t.read,s:t.disposeWhenNodeIsRemoved||t.s||null,na:t.disposeWhen||t.na,ab:null,B:{},J:0,Gb:null};return n[C]=o,n.hc="function"==typeof a,f.V.fn.Fa(n),Object.setPrototypeOf(n,_),t.pure&&(o.jb=!0,o.C=!0,f.g.extend(n,T)),o.s&&(o.nb=!0,o.s.nodeType||(o.s=null)),o.C||n.U(),o.s&&n.isActive()&&f.g.K.ma(o.s,o.ab=()=>{n.A()}),n};var _={pa:t,qa:function(){return this[C].J},dc:function(){var e=[];return f.g.P(this[C].B,((t,n)=>e[n.ka]=n.X)),e},gb:function(e){if(!this[C].J)return!1;var t=this.dc();return t.includes(e)||!!t.find((t=>t.gb&&t.gb(e)))},vb:function(e,t,n){if(this[C].jb&&t===this)throw Error("A 'pure' computed must not be called recursively");this[C].B[e]=n,n.ka=this[C].J++,n.la=t.Ca()},sa:function(){var e,t=this[C].B;for(e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var n=t[e];if(this.va&&n.X.ja||n.X.fc(n.la))return!0}},vc:function(){this[C].Ga||this.va?.(!1)},isActive:function(){var e=this[C];return e.Y||0<e.J},wc:function(){this.ja?this[C].Y&&(this[C].aa=!0):this.Fb()},Sb:function(e){return e.subscribe(this.Fb,this)},Fb:function(){var e=this,t=e.throttleEvaluation;0<=t?(clearTimeout(this[C].Gb),this[C].Gb=setTimeout((()=>e.U(!0)),t)):e.va?e.va(!0):e.U(!0)},U:function(e){var t=this[C],n=t.na,a=!1;if(!t.Ga&&!t.$){if(t.s&&!f.g.bb(t.s)||n?.()){if(!t.nb)return void this.A()}else t.nb=!1;try{t.Ga=!0,a=this.bc(e)}finally{t.Ga=!1}return a}},bc:function(e){var t=this[C],n=t.jb?void 0:!t.J,i={$b:this,za:t.B,Za:t.J};f.o.zb({Zb:i,Yb:o,u:this,Ia:n}),t.B={},t.J=0;e:{try{var r=t.Ob();break e}finally{f.o.end(),i.Za&&!t.C&&f.g.P(i.za,a),t.aa=t.Y=!1}r=void 0}return t.J?i=this.Ha(t.N,r):(this.A(),i=!0),i&&(t.C?this.Na():this.D(t.N,"beforeChange"),t.N=r,this.D(t.N,"spectate"),!t.C&&e&&this.D(t.N),this.tb&&this.tb()),n&&this.D(t.N,"awake"),i},R:function(e){var t=this[C];return(t.Y&&(e||!t.J)||t.C&&this.sa())&&this.U(),t.N},Ja:function(e){var t=this;f.V.fn.Ja.call(t,e),t.qb=()=>(t[C].C||(t[C].aa?t.U():t[C].Y=!1),t[C].N),t.va=e=>{t.rb(t[C].N),t[C].Y=!0,e&&(t[C].aa=!0),t.sb(t,!e)}},A:function(){var e=this[C];!e.C&&e.B&&f.g.P(e.B,((e,t)=>t.A?.())),e.s&&e.ab&&f.g.K.kb(e.s,e.ab),e.B=void 0,e.J=0,e.$=!0,e.aa=!1,e.Y=!1,e.C=!1,e.s=void 0,e.na=void 0,e.Ob=void 0}},T={Ua:function(e){var t=this,n=t[C];if(!n.$&&n.C&&"change"==e){if(n.C=!1,n.aa||t.sa())n.B=null,n.J=0,t.U()&&t.Na();else{var a=[];f.g.P(n.B,((e,t)=>a[t.ka]=e)),a.forEach(((e,a)=>{var o=n.B[e],i=t.Sb(o.X);i.ka=a,i.la=o.la,n.B[e]=i})),t.sa()&&t.U()&&t.Na()}n.$||t.D(n.N,"awake")}},Sa:function(e){var t=this[C];t.$||"change"!=e||this.ra("change")||(f.g.P(t.B,((e,n)=>{n.A&&(t.B[e]={X:n.X,ka:n.ka,la:n.la},n.A())})),t.C=!0,this.D(void 0,"asleep"))},Ca:function(){var e=this[C];return e.C&&(e.aa||this.sa())&&this.U(),f.V.fn.Ca.call(this)}};Object.setPrototypeOf(_,f.V.fn);var L=f.ba.qc;_[L]=f.u,f.v("computed",f.u),f.v("isComputed",(e=>"function"==typeof e&&e[L]===_[L])),f.v("computed.fn",_),f.ha(_,"dispose",_.A),f.Nb=e=>"function"==typeof e?f.u(e,{pure:!0}):(e={...e,pure:!0},f.u(e)),f.F={S:e=>{switch(e.nodeName){case"OPTION":return!0===e.__ko__hasDomDataOptionValue__?f.g.j.get(e,f.h.options.ib):e.value;case"SELECT":return 0<=e.selectedIndex?f.F.S(e.options[e.selectedIndex]):void 0;default:return e.value}},Pa:(e,t,n)=>{switch(e.nodeName){case"OPTION":"string"==typeof t?(f.g.j.set(e,f.h.options.ib,void 0),delete e.__ko__hasDomDataOptionValue__,e.value=t):(f.g.j.set(e,f.h.options.ib,t),e.__ko__hasDomDataOptionValue__=!0,e.value="number"==typeof t?t:"");break;case"SELECT":for(var a,o=-1,i=""===t||null==t,r=e.options.length;r--;)if((a=f.F.S(e.options[r]))==t||""===a&&i){o=r;break}(n||0<=o||i&&1<e.size)&&(e.selectedIndex=o);break;default:e.value=null==t?"":t}}},f.G=(()=>{var e=["true","false","null","undefined"],t=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,n=RegExp("\"(?:\\\\.|[^\"])*\"|'(?:\\\\.|[^'])*'|`(?:\\\\.|[^`])*`|/\\*(?:[^*]|\\*+[^*/])*\\*+/|//.*\n|/(?:\\\\.|[^/])+/w*|[^\\s:,/][^,\"'`{}()/:[\\]]*[^\\s,\"'`{}()/:[\\]]|[^\\s]","g"),a=/[\])"'A-Za-z0-9_$]+$/,o={in:1,return:1,typeof:1},i=e=>{123===(e=f.g.Rb(e)).charCodeAt(0)&&(e=e.slice(1,-1));var t=[],i=(e+="\n,").match(n),r=[],s=0;if(1<i.length){for(var l,c=0;l=i[c++];){var h=l.charCodeAt(0);if(44===h){if(0>=s){t.push(u&&r.length?{key:u,value:r.join("")}:{unknown:u||r.join("")});var u=s=0;r=[];continue}}else if(58===h){if(!s&&!u&&1===r.length){u=r.pop();continue}}else{if(47===h&&1<l.length&&(47===l.charCodeAt(1)||42===l.charCodeAt(1)))continue;47===h&&c&&1<l.length?(h=i[c-1].match(a))&&!o[h[0]]&&(i=(e=e.slice(e.indexOf(l)+1)).match(n),c=-1,l="/"):40===h||123===h||91===h?++s:41===h||125===h||93===h?--s:u||r.length||34!==h&&39!==h||(l=l.slice(1,-1))}r.push(l)}if(0<s)throw Error("Unbalanced parentheses, braces, or brackets")}return t},r=new Set;return{Va:[],Ma:r,oc:i,pc:(n,a)=>{var o=[],s=[],l=a?.valueAccessors,c=a?.bindingParams,h=(n,a)=>{if(!c){var i=f.h[n];if(i?.preprocess&&!(a=i.preprocess(a,n,h)))return;if(i=r.has(n)){var u=a;e.includes(u)?u=!1:(i=u.match(t),u=null!==i&&(i[1]?"Object("+i[1]+")"+i[2]:u)),i=u}i&&s.push("'"+n+"':function(_z){"+u+"=_z}")}l&&(a="function(){return "+a+" }"),o.push("'"+n+"':"+a)};return("string"==typeof n?i(n):n).forEach((e=>h(e.key||e.unknown,e.value))),s.length&&h("_ko_property_writers","{"+s.join(",")+" }"),o.join(",")},mc:(e,t)=>-1<e.findIndex((e=>e.key==t)),Qa:(e,t,n,a,o)=>{e&&f.T(e)?!f.lc(e)||o&&e.R()===a||e(a):t.get("_ko_property_writers")?.[n]?.(a)}}})(),(()=>{function e(e){return 8==e.nodeType&&a.test(e.nodeValue)}function t(e){return 8==e.nodeType&&o.test(e.nodeValue)}function n(n,a){for(var o=n,r=1,s=[];o=o.nextSibling;){if(t(o)&&(f.g.j.set(o,i,!0),!--r))return s;s.push(o),e(o)&&++r}if(!a)throw Error("Cannot find closing comment tag to match: "+n.nodeValue);return null}var a=/^\s*ko(?:\s+([\s\S]+))?\s*$/,o=/^\s*\/ko\s*$/,i="__ko_matchedEndComment__";f.m={ca:{},childNodes:t=>e(t)?n(t):t.childNodes,oa:t=>{e(t)?(t=n(t))&&[...t].forEach((e=>f.removeNode(e))):f.g.cb(t)},ua:(t,n)=>{e(t)?(f.m.oa(t),t.after(...n)):f.g.ua(t,n)},prepend:(t,n)=>{e(t)?t.nextSibling.before(n):t.prepend(n)},jc:(e,t,n)=>{n?n.after(t):f.m.prepend(e,t)},firstChild:n=>{if(e(n))return!(n=n.nextSibling)||t(n)?null:n;let a=n.firstChild;if(a&&t(a))throw Error("Found invalid end comment, as the first child of "+n);return a},nextSibling:a=>{if(e(a)){var o=n(a,void 0);a=o?(o.length?o[o.length-1]:a).nextSibling:null}if((o=a.nextSibling)&&t(o)){if(t(o)&&!f.g.j.get(o,i))throw Error("Found end comment without a matching opening comment, as child of "+a);return null}return o},ec:e,uc:e=>(e=e.nodeValue.match(a))?e[1]:null}})();const x=new Map;f.Ab=new class{nc(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind");case 8:return f.m.ec(e)}return!1}cc(e,t){e:{switch(e.nodeType){case 1:var n=e.getAttribute("data-bind");break e;case 8:n=f.m.uc(e);break e}n=null}if(n)try{let o={valueAccessors:!0},i=x.get(n);if(!i){var a="with($context){with($data||{}){return{"+f.G.pc(n,o)+"}}}";i=new Function("$context","$element",a),x.set(n,i)}return i(t,e)}catch(e){throw e.message="Unable to parse bindings.\nBindings value: "+n+"\nMessage: "+e.message,e}return null}};const k=Symbol("_subscribable"),O=Symbol("_ancestorBindingInfo"),A=Symbol("_dataDependency"),w={},D=f.g.j.Z();f.h={},f.ea=class{constructor(e,t,n,a,o){var i=this,r=e===w,s=r?void 0:e,l="function"==typeof s&&!f.T(s),c=o?.dataDependency;if(e=()=>{var e=l?s():s,o=f.g.i(e);return t?(f.g.extend(i,t),O in t&&(i[O]=t[O])):(i.$parents=[],i.$root=o,i.ko=f),i[k]=h,r?o=i.$data:(i.$rawData=e,i.$data=o),n&&(i[n]=o),a?.(i,t,o),t?.[k]&&!f.o.u().gb(t[k])&&t[k](),c&&(i[A]=c),i.$data},o?.exportDependencies)e();else{var h=f.Nb(e);h.R(),h.isActive()?h.pa=null:i[k]=void 0}}createChildContext(e,t,n,a){return!a&&t&&"object"==typeof t&&(t=(a=t).as,n=a.extend),new f.ea(e,this,t,((e,t)=>{e.$parentContext=t,e.$parent=t.$data,e.$parents=(t.$parents||[]).slice(0),e.$parents.unshift(e.$parent),n&&n(e)}),a)}extend(e,t){return new f.ea(w,this,null,(t=>f.g.extend(t,"function"==typeof e?e(t):e)),t)}};class ma{constructor(e,t,n){this.L=e,this.ia=t,this.xa=new Set,this.H=!1,t.I||f.g.K.ma(e,i),n?.I&&(n.I.xa.add(e),this.Da=n)}Mb(){this.Da?.I?.ac(this.L)}ac(e){this.xa.delete(e),this.xa.size||this.Db?.()}Db(){this.H=!0,this.ia.I&&!this.xa.size&&(this.ia.I=null,f.g.K.kb(this.L,i),f.l.notify(this.L,f.l.ga),this.Mb())}}f.l={H:"childrenComplete",ga:"descendantsComplete",subscribe:(e,t,n,a,o)=>{var i=f.g.j.fb(e,D,{});return i.Aa||(i.Aa=new f.V),o?.notifyImmediately&&i.hb[t]&&f.o.M(n,a,[e]),i.Aa.subscribe(n,a,t)},notify:(e,t)=>{var n=f.g.j.get(e,D);if(n&&(n.hb[t]=!0,n.Aa?.D(e,t),t==f.l.H))if(n.I)n.I.Db();else if(void 0===n.I&&n.Aa?.ra(f.l.ga))throw Error("descendantsComplete event not supported for bindings on this node")},mb:(e,t)=>{var n=f.g.j.fb(e,D,{});return n.I||(n.I=new ma(e,n,t[O])),t[O]==n?t:t.extend((e=>{e[O]=n}))}},f.tc=e=>(e=f.g.j.get(e,D))&&e.context,f.wb=(e,t,n)=>l(e,t,c(n)),f.yb=(e,t)=>{1!==t.nodeType&&8!==t.nodeType||r(c(e),t)},f.xb=function(e,t,n){if(2>arguments.length){if(!(t=h.body))throw Error("ko.applyBindings: could not find document.body; has the document been loaded?")}else if(!t||1!==t.nodeType&&8!==t.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");s(c(e,n),t)},f.Eb=e=>(e=e&&[1,8].includes(e.nodeType)&&f.tc(e))?e.$data:void 0,f.v("bindingHandlers",f.h),f.v("applyBindings",f.xb),f.v("applyBindingAccessorsToNode",f.wb),f.v("dataFor",f.Eb),(()=>{var e=Object.create(null),t=new Map;f.Xa={get:(n,a)=>{if(t.has(n))a(t.get(n));else{var i=e[n];i?i.subscribe(a):((i=e[n]=new f.V).subscribe(a),o(n,(a=>{t.set(n,a),delete e[n],i.D(a)})))}},register:(e,t)=>{if(!t)throw Error("Invalid configuration for "+e);if(n[e])throw Error("Component "+e+" is already registered");n[e]=t}};var n=Object.create(null),a=(e,t)=>{throw Error(`Component '${e}': ${t}`)},o=(e,t)=>{var o={},i=n[e]||{},r=i.template;if(i=i.viewModel,r){r.element||a(e,"Unknown template value: "+r),r=r.element;var s=h.getElementById(r);s||a(e,"Cannot find element with ID "+r),s.matches("TEMPLATE")||a(e,"Template Source Element not a <template>"),o.template=f.g.ya(s.content.childNodes)}i&&("function"!=typeof i.createViewModel&&a(e,"Unknown viewModel value: "+i),o.createViewModel=i.createViewModel),t(o.template&&o.createViewModel?o:null)};f.v("components",f.Xa),f.v("components.register",f.Xa.register)})(),(()=>{var e=0;f.h.component={init:(t,n,a,o,i)=>{var r,s,l,c=()=>{var e=r&&r.dispose;"function"==typeof e&&e.call(r),l&&l.A(),s=r=l=null},h=[...f.m.childNodes(t)];return f.m.oa(t),f.g.K.ma(t,c),f.u((()=>{var a=f.g.i(n());if("string"!=typeof a){var o=f.g.i(a.params);a=f.g.i(a.name)}if(!a)throw Error("No component name specified");var l=f.l.mb(t,i),u=s=++e;f.Xa.get(a,(e=>{if(s===u){if(c(),!e)throw Error("Unknown component '"+a+"'");var n=e.template;if(!n)throw Error("Component '"+a+"' has no template");f.m.ua(t,f.g.ya(n)),r=e.createViewModel(o,{element:t,templateNodes:h}),f.yb(l.createChildContext(r,{extend:e=>{e.$component=r,e.$componentTemplateNodes=h}}),t)}}))}),{s:t}),{controlsDescendantBindings:!0}}},f.m.ca.component=!0})(),f.h.attr={update:(e,t)=>{t=f.g.i(t())||{},f.g.P(t,(function(t,n){n=f.g.i(n);var a=t.indexOf(":");a="lookupNamespaceURI"in e&&0<a&&e.lookupNamespaceURI(t.slice(0,a));var o=!1===n||null==n;o?a?e.removeAttributeNS(a,t):e.removeAttribute(t):(n=n.toString(),a?e.setAttributeNS(a,t,n):e.setAttribute(t,n)),"name"===t&&(e.name=o?"":n)}))}},f.h.checked={after:["value","attr"],init:function(e,t,n){var a="checkbox"==e.type,o="radio"==e.type;if(a||o){const i=f.Nb((()=>{if(o)return n.has("value")?f.g.i(n.get("value")):e.value}));e.addEventListener("click",(()=>{if(!f.o.Ia()){var r=e.checked;if(r||!o&&!f.o.qa()){r=a?r:i();var s=f.o.M(t);f.G.Qa(s,n,"checked",r,!0)}}})),f.u((()=>{var n=f.g.i(t());e.checked=a?!!n:i()===n}),null,{s:e})}}},f.G.Ma.checked=!0;var R=(e,t,n)=>t&&t.split(/\s+/).forEach((t=>e.classList.toggle(t,n)));f.h.css={update:(e,t)=>{"object"==typeof(t=f.g.i(t()))?f.g.P(t,((t,n)=>{n=f.g.i(n),R(e,t,!!n)})):(t=f.g.Rb(t),R(e,e.__ko__cssValue,!1),e.__ko__cssValue=t,R(e,t,!0))}},f.h.enable={update:(e,t)=>{(t=f.g.i(t()))&&e.disabled?e.removeAttribute("disabled"):t||e.disabled||(e.disabled=!0)}},f.h.disable={update:(e,t)=>f.h.enable.update(e,(()=>!f.g.i(t())))},f.h.event={init:(e,t,n,a,o)=>{f.g.P(t()||{},(n=>{"string"==typeof n&&e.addEventListener(n,((...e)=>{var i=t()[n];if(i)try{a=o.$data;var r=i.apply(a,[a,...e])}finally{!0!==r&&e[0].preventDefault()}}))}))}},f.h.foreach={Kb:e=>()=>{var t=e(),n=f.T(t)?t.R():t;return n&&"number"!=typeof n.length?(f.g.i(t),{foreach:n.data,as:n.as,beforeRemove:n.beforeRemove}):{foreach:t}},init:(e,t)=>f.h.template.init(e,f.h.foreach.Kb(t)),update:(e,t,n,a,o)=>f.h.template.update(e,f.h.foreach.Kb(t),n,a,o)},f.G.Va.foreach=!1,f.m.ca.foreach=!0,f.h.hasfocus={init:(e,t,n)=>{var a=a=>{e.__ko_hasfocusUpdating=!0,a=e.ownerDocument.activeElement===e,f.G.Qa(t(),n,"hasfocus",a,!0),e.__ko_hasfocusLastValue=a,e.__ko_hasfocusUpdating=!1},o=a.bind(null,!0);a=a.bind(null,!1),e.addEventListener("focus",o),e.addEventListener("focusin",o),e.addEventListener("blur",a),e.addEventListener("focusout",a),e.__ko_hasfocusLastValue=!1},update:(e,t)=>{t=!!f.g.i(t()),e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===t||(t?e.focus():e.blur())}},f.G.Ma.add("hasfocus"),f.h.html={init:()=>({controlsDescendantBindings:!0}),update:(e,t)=>{if(f.g.cb(e),null!=(t=f.g.i(t()))){const n=h.createElement("template");n.innerHTML="string"!=typeof t?t.toString():t,e.appendChild(n.content)}}},(()=>{function e(e,t,n){f.h[e]={init:(e,a,o,i,r)=>{var s,l={};t&&(l={as:o.get("as"),exportDependencies:!0});var c=o.has(f.l.ga);return f.u((()=>{var o=f.g.i(a()),i=!n!=!o,h=!s;if(c&&(r=f.l.mb(e,r)),i){l.dataDependency=f.o.u();var u=t?r.createChildContext("function"==typeof o?o:a,l):f.o.qa()?r.extend(null,l):r}h&&f.o.qa()&&(s=f.g.ya(f.m.childNodes(e),!0)),i?(h||f.m.ua(e,f.g.ya(s)),f.yb(u,e)):(f.m.oa(e),f.l.notify(e,f.l.H))}),{s:e}),{controlsDescendantBindings:!0}}},f.G.Va[e]=!1,f.m.ca[e]=!0}e("if"),e("ifnot",!1,!0),e("with",!0)})();var B={};f.h.options={init:e=>{if(!e.matches("SELECT"))throw Error("options binding applies only to SELECT elements");let t=e.length;for(;t--;)e.remove(t);return{controlsDescendantBindings:!0}},update:(e,t,n)=>{var a=e.multiple,o=0!=e.length&&a?e.scrollTop:null,i=f.g.i(t()),r=n.get("valueAllowUnset")&&n.has("value"),s={},l=[];t=()=>Array.from(e.options).filter((e=>e.selected));var c=(e,t,n)=>{var a=typeof t;return"function"==a?t(e):"string"==a?e[t]:n},h=(t,n)=>{p&&r?f.l.notify(e,f.l.H):l.length&&(t=l.includes(f.F.S(n[0])),n[0].selected=t,p&&!t&&f.o.M(f.g.Tb,null,[e,"change"]))};if(r||(a?l=t().map(f.F.S):0<=e.selectedIndex&&l.push(f.F.S(e.options[e.selectedIndex]))),i){void 0===i.length&&(i=[i]);var u=i.filter((e=>e||null==e));n.has("optionsCaption")&&(null!=(i=f.g.i(n.get("optionsCaption")))&&u.unshift(B))}var p=!1;s.beforeRemove=t=>e.removeChild(t),i=h,n.has("optionsAfterRender")&&"function"==typeof n.get("optionsAfterRender")&&(i=(e,t)=>{h(e,t),f.o.M(n.get("optionsAfterRender"),null,[t[0],e!==B?e:void 0])}),f.g.Qb(e,u,((t,a,o)=>(o.length&&(l=!r&&o[0].selected?[f.F.S(o[0])]:[],p=!0),a=e.ownerDocument.createElement("option"),t===B?(f.g.lb(a,n.get("optionsCaption")),f.F.Pa(a,void 0)):(o=c(t,n.get("optionsValue"),t),f.F.Pa(a,f.g.i(o)),t=c(t,n.get("optionsText"),o),f.g.lb(a,t)),[a])),s,i),r||(u=l.length,(a?u&&t().length<u:u&&0<=e.selectedIndex?f.F.S(e.options[e.selectedIndex])!==l[0]:u||0<=e.selectedIndex)&&f.o.M(f.g.Tb,null,[e,"change"])),(r||f.o.Ia())&&f.l.notify(e,f.l.H),o&&20<Math.abs(o-e.scrollTop)&&(e.scrollTop=o)}},f.h.options.ib=f.g.j.Z(),f.h.style={update:(e,t)=>{f.g.P(f.g.i(t()||{}),((t,n)=>{if(null!=(n=f.g.i(n))&&!1!==n||(n=""),/^--/.test(t))e.style.setProperty(t,n);else{t=t.replace(/-(\w)/g,((e,t)=>t.toUpperCase()));var a=e.style[t];e.style[t]=n,n===a||e.style[t]!=a||isNaN(n)||(e.style[t]=n+"px")}}))}},f.h.submit={init:(e,t,n,a,o)=>{if("function"!=typeof t())throw Error("The value for a submit binding must be a function");e.addEventListener("submit",(n=>{var a=t();try{var i=a.call(o.$data,e)}finally{!0!==i&&n.preventDefault()}}))}},f.h.text={init:()=>({controlsDescendantBindings:!0}),update:(e,t)=>{8===e.nodeType&&(e.text||e.after(e.text=h.createTextNode("")),e=e.text),f.g.lb(e,t())}},f.m.ca.text=!0,f.h.textInput={init:(e,t,n)=>{var a,o,i=e.value,r=()=>{clearTimeout(a),o=a=void 0;var r=e.value;i!==r&&(i=r,f.G.Qa(t(),n,"textInput",r))},s=()=>{var n=f.g.i(t());null==n&&(n=""),void 0!==o&&n===o?setTimeout(s,4):e.value!==n&&(e.value=n,i=e.value)};e.addEventListener("input",r),e.addEventListener("change",r),e.addEventListener("blur",r),f.u(s,{s:e})}},f.G.Ma.add("textInput"),f.h.textinput={preprocess:(e,t,n)=>n("textInput",e)},f.h.value={init:(e,t,n)=>{var a=e.matches("SELECT"),o=e.matches("INPUT");if(!o||"checkbox"!=e.type&&"radio"!=e.type){var i=new Set,r=n.get("valueUpdate"),s=null,l=()=>{s=null;var a=t(),o=f.F.S(e);f.G.Qa(a,n,"value",o)};r&&("string"==typeof r?i.add(r):r.forEach((e=>i.add(e))),i.delete("change")),i.forEach((t=>{var n=l;(t||"").startsWith("after")&&(n=()=>{s=f.F.S(e),setTimeout(l,0)},t=t.slice(5)),e.addEventListener(t,n)}));var c,h=o&&"file"==e.type?()=>{var n=f.g.i(t());null==n||""===n?e.value="":f.o.M(l)}:()=>{var o=f.g.i(t()),i=f.F.S(e);null!==s&&o===s?setTimeout(h,0):o===i&&void 0!==i||(a?(i=n.get("valueAllowUnset"),f.F.Pa(e,o,i),i||o===f.F.S(e)||f.o.M(l)):f.F.Pa(e,o))};if(a)f.l.subscribe(e,f.l.H,(()=>{c?n.get("valueAllowUnset")?h():l():(e.addEventListener("change",l),c=f.u(h,{s:e}))}),null,{notifyImmediately:!0});else e.addEventListener("change",l),f.u(h,{s:e})}else f.wb(e,{checkedValue:t})},update:()=>{}},f.G.Ma.add("value"),f.h.visible={update:(e,t)=>{t=f.g.i(t());var n="none"!=e.style.display;t&&!n?e.style.display="":n&&!t&&(e.style.display="none")}},f.h.hidden={update:(e,t)=>e.hidden=!!f.g.i(t())},function(e){f.h[e]={init:function(t,n,a,o,i){return f.h.event.init.call(this,t,(()=>({[e]:n()})),a,o,i)}}}("click"),(()=>{let e=f.g.j.Z();class b{constructor(e){this.$a=e}Ka(...t){let n=this.$a;if(!t.length)return f.g.j.get(n,e)||(11===this.L?n.content:1===this.L?n:void 0);f.g.j.set(n,e,t[0])}}f.La={$a:class d extends b{constructor(e){super(e),e&&(this.L=e.matches("TEMPLATE")&&e.content?e.content.nodeType:1)}},Ta:b}})(),(()=>{var e=(e,t)=>{if(e.length){var n=e[0],a=n.parentNode;((e,t,n)=>{var a;for(t=f.m.nextSibling(t);e&&(a=e)!==t;)n(a,e=f.m.nextSibling(a))})(n,e[e.length-1],(e=>{1!==e.nodeType&&8!==e.nodeType||f.xb(t,e)})),f.g.Ba(e,a)}},t=(t,n,a,o)=>{var i=(t&&(t.nodeType?t:0<t.length?t[0]:null)||a||{}).ownerDocument;if("string"==typeof a){if(!(i=(i=i||h).getElementById(a)))throw Error("Cannot find template with ID "+a);a=new f.La.$a(i)}else{if(![1,8].includes(a.nodeType))throw Error("Unknown template type: "+a);a=new f.La.Ta(a)}if("number"!=typeof(a=(a=a.Ka?a.Ka():null)?[...a.cloneNode(!0).childNodes]:null).length||0<a.length&&"number"!=typeof a[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(i=!1,n){case"replaceChildren":f.m.ua(t,a),i=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+n)}return i&&(e(a,o),"replaceChildren"==n&&f.l.notify(t,f.l.H)),a},n=(e,t,n)=>f.T(e)?e():"function"==typeof e?e(t,n):e;f.rc=function(e,a,o,i){o=o||{};var r=r||"replaceChildren";if(i){var s=i.nodeType?i:0<i.length?i[0]:null;return f.u((()=>{var o=a instanceof f.ea?a:new f.ea(a,null,null,null,{exportDependencies:!0}),s=n(e,o.$data,o);t(i,r,s,o)}),{na:()=>!s||!f.g.bb(s),s:s})}},f.sc=(a,o,i,r,s)=>{function l(e,t){f.o.M(f.g.Qb,null,[r,e,u,i,p,t]),f.l.notify(r,f.l.H)}var c,h=i.as,u=(e,o)=>(c=s.createChildContext(e,{as:h,extend:e=>{e.$index=o,h&&(e[h+"Index"]=o)}}),e=n(a,e,c),t(r,"ignoreTargetNode",e,c)),p=(t,n)=>{e(n,c),c=null};if(!i.beforeRemove&&f.Jb(o)){l(o.R());var g=o.subscribe((e=>{l(o(),e)}),null,"arrayChange");return g.s(r),g}return f.u((()=>{var e=f.g.i(o)||[];void 0===e.length&&(e=[e]),l(e)}),{s:r})};var a=f.g.j.Z(),o=f.g.j.Z();f.h.template={init:(e,t)=>{if("string"==typeof(t=f.g.i(t()))||"name"in t)f.m.oa(e);else if("nodes"in t){if(t=t.nodes||[],f.T(t))throw Error('The "nodes" option must be a plain, non-observable array.');let n=t[0]?.parentNode;n&&f.g.j.get(n,o)||(n=f.g.Lb(t),f.g.j.set(n,o,!0)),new f.La.Ta(e).Ka(n)}else{if(!(t=f.m.childNodes(e)).length)throw Error("Anonymous template defined, but no template content was provided");t=f.g.Lb(t),new f.La.Ta(e).Ka(t)}return{controlsDescendantBindings:!0}},update:(e,t,n,o,i)=>{var r=t();n=!0,o=null,"string"==typeof(t=f.g.i(r))?t={}:(r="name"in t?t.name:e,"if"in t&&(n=f.g.i(t.if)),n&&"ifnot"in t&&(n=!f.g.i(t.ifnot)),n&&!r&&(n=!1)),"foreach"in t?o=f.sc(r,n&&t.foreach||[],t,e,i):n?(n=i,"data"in t&&(n=i.createChildContext(t.data,{as:t.as,exportDependencies:!0})),o=f.rc(r,n,t,e)):f.m.oa(e),i=o,f.g.j.get(e,a)?.A?.(),f.g.j.set(e,a,!i||i.isActive&&!i.isActive()?void 0:i)}},f.G.Va.template=e=>1==(e=f.G.oc(e)).length&&e[0].unknown||f.G.mc(e,"name")?null:"This template engine does not support anonymous templates nested within its templates",f.m.ca.template=!0})(),f.g.Hb=(e,t,n)=>{var a,o=0,i=t.length;i&&e.every((e=>(0<=(a=t.findIndex((t=>e.value===t.value)))&&(e.moved=t[a].index,t[a].moved=e.index,t.splice(a,1),o=a=0,--i),o+=i,i&&(!n||o<n))))},f.g.Cb=(()=>{var e=(e,t,n,a,o)=>{for(var i,r,s,l,c=Math.min,h=Math.max,u=[],p=-1,g=e.length,m=t.length,v=m-g||1,y=g+m+1;++p<=g;)for(s=r,u.push(r=[]),l=c(m,p+v),i=h(0,p-1);i<=l;i++)r[i]=i?p?e[p-1]===t[i-1]?s[i-1]:c(s[i]||y,r[i-1]||y)+1:i+1:p+1;for(c=[],h=[],v=[],p=g,i=m;p||i;)m=u[p][i]-1,i&&m===u[p][i-1]?h.push(c[c.length]={status:n,value:t[--i],index:i}):p&&m===u[p-1][i]?v.push(c[c.length]={status:a,value:e[--p],index:p}):(--i,--p,o.sparse||c.push({status:"retained",value:t[i]}));return f.g.Hb(v,h,!o.dontLimitMoves&&10*g),c.reverse()};return(t,n,a)=>(a="boolean"==typeof a?{dontLimitMoves:a}:a||{},n=n||[],(t=t||[]).length<n.length?e(t,n,"added","deleted",a):e(n,t,"deleted","added",a))})(),(()=>{var e=f.g.j.Z(),t=f.g.j.Z();f.g.Qb=(n,a,o,i,r,s)=>{void 0===(a=a||[]).length&&(a=[a]),i=i||{};var l=f.g.j.get(n,e),c=[],h=0,u=0,p=[],g=[],m=[],v=0,y=e=>{L={da:e,Ea:f.ba(u++)},c.push(L)},S=e=>{(L=l[e]).Ea(u++),f.g.Ba(L.O,n),c.push(L)};if(l){let e,o;for((!s||l&&l._countWaitingForRemove)&&(s=f.g.Cb(Array.prototype.map.call(l,(e=>e.da)),a,{dontLimitMoves:i.dontLimitMoves,sparse:!0})),s.forEach((a=>{switch(e=a.moved,o=a.index,a.status){case"deleted":for(;h<o;)S(h++);void 0===e&&((L=l[h]).Ya&&(L.Ya.A(),L.Ya=void 0),f.g.Ba(L.O,n).length&&(i.beforeRemove&&(c.push(L),v++,L.da===t?L=null:m[L.Ea.R()]=L),L&&p.push.apply(p,L.O))),h++;break;case"added":for(;u<o;)S(h++);void 0!==e?(g.push(c.length),S(e)):y(a.value)}}));u<a.length;)S(h++);c._countWaitingForRemove=v}else a.forEach(y);f.g.j.set(n,e,c),p.forEach(i.beforeRemove?f.fa:f.removeNode);var E,N,C,_,T=e=>{f.m.jc(n,e,N),N=e};if(s=n.ownerDocument.activeElement,g.length)for(;null!=(E=g.shift());){var L=c[E];for(N=void 0;E;)if(a=c[--E].O,a?.length){N=a[a.length-1];break}L.O.forEach(T)}c.forEach((e=>{e.O||f.g.extend(e,function(e,t,n,a,o){var i=[],r=f.u((()=>{var r=t(n,o,f.g.Ba(i,e))||[];if(0<i.length){var s=i.nodeType?[i]:i;if(0<s.length){var l=s[0],c=l.parentNode;r.forEach((e=>c.insertBefore(e,l))),s.forEach((e=>f.removeNode(e)))}a&&f.o.M(a,null,[n,r,o])}i.length=0,i.push(...r)}),{s:e,na:()=>!!i.find(f.g.bb)});return{O:i,Ya:r.isActive()?r:void 0}}(n,o,e.da,r,e.Ea)),e.O.forEach(T),!e.ic&&r&&(r(e.da,e.O,e.Ea),e.ic=!0,N=e.O[e.O.length-1])})),n.ownerDocument.activeElement!=s&&s?.focus(),C=i.beforeRemove,_=m,C&&_.forEach((e=>e?.O.forEach((t=>C(t,E,e.da))))),m.forEach((e=>e&&(e.da=t)))}})(),e.ko=u})(this),(e=>{const t="DIV",n=3,a="​",o=" ",i=e.defaultView,r=navigator.userAgent,s=/Mac OS X/.test(r),l=/iP(?:ad|hone|od)/.test(r)||s&&!!navigator.maxTouchPoints,c=/WebKit\//.test(r),h=s?"meta-":"ctrl-",u=s?"metaKey":"ctrlKey",f=/[^ \t\r\n]/,p=(e,t)=>Array.prototype.indexOf.call(e,t),g=NodeFilter.FILTER_ACCEPT,m=/^(?:#text|A|ABBR|ACRONYM|B|BR|BD[IO]|CITE|CODE|DATA|DEL|DFN|EM|FONT|HR|I|IMG|INPUT|INS|KBD|Q|RP|RT|RUBY|S|SAMP|SMALL|SPAN|STR(IKE|ONG)|SU[BP]|TIME|U|VAR|WBR)$/,v={BR:1,HR:1,IMG:1},y=e=>1===e.nodeType,S=e=>y(e)&&!!v[e.nodeName],E=e=>{switch(e.nodeType){case n:return 1;case 1:case 11:if(He.has(e))return He.get(e);break;default:return 0}let t=Array.prototype.every.call(e.childNodes,N)?m.test(e.nodeName)?1:2:3;return He.set(e,t),t},N=e=>1===E(e),C=e=>2===E(e),_=e=>3===E(e),T=(t,n,a)=>e.createTreeWalker(t,n,a?{acceptNode:e=>a(e)?g:NodeFilter.FILTER_SKIP}:null),L=(e,t)=>{let n=T(t,1,C);return n.currentNode=e,n},x=(e,t)=>(e=L(e,t).previousNode())!==t?e:null,k=(e,t)=>(e=L(e,t).nextNode())!==t?e:null,O=e=>!e.textContent&&!e.querySelector("IMG"),A=(e,t)=>!S(e)&&e.nodeType===t.nodeType&&e.nodeName===t.nodeName&&"A"!==e.nodeName&&e.className===t.className&&e.style?.cssText===t.style?.cssText,w=(e,t,n)=>e.nodeName===t&&Object.entries(n||{}).every((([t,n])=>e.getAttribute(t)===n)),D=(e,t,n)=>(e=e&&!e.closest?e.parentElement:e,e=e?.closest(n),e&&t.contains(e)?e:null),R=(e,t,n,a)=>{for(;e&&e!==t;){if(w(e,n,a))return e;e=e.parentNode}return null},B=(e,t)=>{let n,a="";return e&&e!==t&&(a=B(e.parentNode,t),y(e)&&(a+=(a?">":"")+e.nodeName,e.id&&(a+="#"+e.id),e.classList.length&&(a+="."+[...e.classList].sort().join(".")),e.dir&&(a+="[dir="+e.dir+"]"),(n=e.style.cssText)&&(a+="[style="+n+"]"))),a},I=e=>{let t=e.nodeType;return 1===t||11===t?e.childNodes.length:e.length||0},U=e=>(e.parentNode?.removeChild(e),e),P=t=>{let n=e.createDocumentFragment(),a=t.childNodes;return a&&n.append(...a),n},M=(e,t)=>{t&&Object.entries(t).forEach((([t,n])=>{"style"===t&&"object"==typeof n?Object.entries(n).forEach((([t,n])=>e.style[t]=n)):null!=n?e.setAttribute(t,n):e.removeAttribute(t)}))},F=(t,n,a)=>{let o=e.createElement(t);return n instanceof Array&&(a=n,n=null),M(o,n),a&&o.append(...a),o},j=(e,t)=>{let n=null;if(e instanceof Text)return e;if(N(e)){let t=e.firstChild;if(cantFocusEmptyTextNodes)for(;t&&t instanceof Text&&!t.data;)e.removeChild(t),t=e.firstChild;t||(n=cantFocusEmptyTextNodes?document.createTextNode(a):document.createTextNode(""))}else if(e instanceof Element&&!e.querySelector("BR")){n=F("BR");let t,a=e;for(;(t=a.lastElementChild)&&!N(t);)a=t}if(n)try{e.appendChild(n)}catch(t){se({name:"Squire: fixCursor – "+t,message:"Parent: "+e.nodeName+"/"+e.innerHTML+" appendChild: "+n.nodeName})}return e},H=(e,t)=>{let n,a;return[...e.childNodes].forEach((e=>{a="BR"===e.nodeName,!a&&N(e)?(n=n||F("div"),n.append(e)):(a||n)&&(n=n||F("div"),j(n),e[a?"replaceWith":"before"](n),n=null),_(e)&&H(e,t)})),n&&e.append(j(n)),e},q=(e,t,a,o)=>{let i,r,s,l=e.nodeType;if(l===n&&e!==a)return q(e.parentNode,e.splitText(t),a,o);if(1===l){if("number"==typeof t&&(t=t<e.childNodes.length?e.childNodes[t]:null),e===a)return t;for(i=e.parentNode,r=e.cloneNode(!1);t;)s=t.nextSibling,r.append(t),t=s;return"OL"===e.nodeName&&D(e,o,"BLOCKQUOTE")&&(r.start=(+e.start||1)+e.childNodes.length-1),j(e),j(r),e.after(r),q(i,r,a,o)}return t},$=(e,t)=>{let a,o,i=e.childNodes,r=i.length,s=[];for(;r--;)a=i[r],o=r&&i[r-1],r&&N(a)&&A(a,o)&&!v[a.nodeName]?(t.startContainer===a&&(t.startContainer=o,t.startOffset+=I(o)),t.endContainer===a&&(t.endContainer=o,t.endOffset+=I(o)),t.startContainer===e&&(t.startOffset>r?--t.startOffset:t.startOffset===r&&(t.startContainer=o,t.startOffset=I(o))),t.endContainer===e&&(t.endOffset>r?--t.endOffset:t.endOffset===r&&(t.endContainer=o,t.endOffset=I(o))),U(a),a.nodeType===n?o.appendData(a.data):s.push(P(a))):y(a)&&(a.append(...s.reverse()),s=[],$(a,t))},W=(e,t)=>{if(e.nodeType===n&&(e=e.parentNode),y(e)){let n={startContainer:t.startContainer,startOffset:t.startOffset,endContainer:t.endContainer,endOffset:t.endOffset};$(e,n),t.setStart(n.startContainer,n.startOffset),t.setEnd(n.endContainer,n.endOffset)}},V=(e,t,n,a)=>{let o,i,r,s=t;for(;(o=s.parentNode)&&o!==a&&y(o)&&1===o.childNodes.length;)s=o;U(s),r=e.childNodes.length,i=e.lastChild,"BR"===i?.nodeName&&(i.remove(),--r),e.append(P(t)),n.setStart(e,r),n.collapse(!0),W(e,n)},z=(e,t)=>{let n,a,o=e.previousSibling,i=e.firstChild,r="LI"===e.nodeName;if(!r||i&&/^[OU]L$/.test(i.nodeName))if(o&&A(o,e)){if(!_(o)){if(!r)return;a=F("DIV"),a.append(P(o)),o.append(a)}U(e),n=!_(e),o.append(P(e)),n&&H(o,t),i&&z(i,t)}else r&&(o=F("DIV"),e.insertBefore(o,i),j(o))},K=(e,t)=>{let n=e.childNodes;for(;t&&y(e);)n=(e=n[t-1]).childNodes,t=n.length;return e},G=(e,t)=>{if(y(e)){let n=e.childNodes;if(t<n.length)e=n[t];else{for(;e&&!e.nextSibling;)e=e.parentNode;e&&(e=e.nextSibling)}}return e},Q=(e,t)=>{let a,o,i,r,s=e.startContainer,l=e.startOffset,c=e.endContainer,h=e.endOffset;s.nodeType===n?(a=s.parentNode,o=a.childNodes,l===s.length?(l=p(o,s)+1,e.collapsed&&(c=a,h=l)):(l&&(r=s.splitText(l),c===s?(h-=l,c=r):c===a&&++h,s=r),l=p(o,s)),s=a):o=s.childNodes,i=o.length,l===i?s.append(t):s.insertBefore(t,o[l]),s===c&&(h+=o.length-i),e.setStart(s,l),e.setEnd(c,h)},X=(t,a,i)=>{let r=t.startContainer,s=t.startOffset,l=t.endContainer,c=t.endOffset;a||(a=t.commonAncestorContainer),a.nodeType===n&&(a=a.parentNode);let h,u,f,g,m,v=q(l,c,a,i),y=q(r,s,a,i),S=e.createDocumentFragment();for(;y!==v;)h=y.nextSibling,S.append(y),y=h;return r=a,s=v?p(a.childNodes,v):a.childNodes.length,f=a.childNodes[s],u=f?.previousSibling,u?.nodeType===n&&f.nodeType===n&&(r=u,s=u.length,g=u.data,m=f.data," "===g.charAt(g.length-1)&&" "===m.charAt(0)&&(m=o+m.slice(1)),u.appendData(m),U(f)),t.setStart(r,s),t.collapse(!0),j(a),S},Z=(e,t)=>{let n,a,o=ne(e,t),i=ae(e,t),r=o!==i;return J(e),ee(e,o,i,t),n=X(e,null,t),J(e),r&&(i=ae(e,t),o&&i&&o!==i&&V(o,i,e,t)),o&&j(o),a=t.firstChild,a&&"BR"!==a.nodeName?e.collapse(!0):(j(t),e.selectNodeContents(t.firstChild)),n},Y=(t,n,a=!0)=>{let o=e.createRange();return o.selectNode(n),a?t.compareBoundaryPoints(3,o)<0&&t.compareBoundaryPoints(1,o)>0:t.compareBoundaryPoints(0,o)<1&&t.compareBoundaryPoints(2,o)>-1},J=e=>{let t,a=e.startContainer,o=e.startOffset,i=e.endContainer,r=e.endOffset,s=!0;for(;a.nodeType!==n&&(t=a.childNodes[o],t&&!S(t));)a=t,o=0;if(r)for(;i.nodeType!==n;){if(t=i.childNodes[r-1],!t||S(t)){if(s&&"BR"===t?.nodeName){--r,s=!1;continue}break}i=t,r=I(i)}else for(;i.nodeType!==n&&(t=i.firstChild,t&&!S(t));)i=t;e.collapsed?(e.setStart(i,r),e.setEnd(a,o)):(e.setStart(a,o),e.setEnd(i,r))},ee=(e,t,a,o)=>{let i,r=e.startContainer,s=e.startOffset,l=e.endContainer,c=e.endOffset,h=!0;for(t||(t=e.commonAncestorContainer),a||(a=t);!s&&r!==t&&r!==o;)i=r.parentNode,s=p(i.childNodes,r),r=i;for(;l!==a&&l!==o&&(h&&l.nodeType!==n&&l.childNodes[c]&&"BR"===l.childNodes[c].nodeName&&(++c,h=!1),c===I(l));)i=l.parentNode,c=p(i.childNodes,l)+1,l=i;e.setStart(r,s),e.setEnd(l,c)},te=(e,t,n)=>{let a=D(e.endContainer,n,"A");if(a){let t=e.cloneRange();a=a.parentNode,ee(t,a,a,n),t.endContainer===a&&(e.setStart(t.endContainer,t.endOffset),e.setEnd(t.endContainer,t.endOffset))}return e},ne=(e,t)=>{let n,a=e.startContainer;return n=N(a)?x(a,t):a!==t&&C(a)?a:k(K(a,e.startOffset),t),n&&Y(e,n)?n:null},ae=(e,t)=>{let n,a,o=e.endContainer;if(N(o))n=x(o,t);else if(o!==t&&C(o))n=o;else{if(n=G(o,e.endOffset),!n||!t.contains(n))for(n=t;a=n.lastChild;)n=a;n=x(n,t)}return n&&Y(e,n)?n:null},oe=e=>T(e,5,(e=>e.nodeType===n?f.test(e.data):"IMG"===e.nodeName)),ie=(e,t)=>{let a,o=e.startContainer,i=e.startOffset;if(ne(e,t)){if(o.nodeType===n){if(i)return!1;a=o}else if(a=G(o,i),(!a||!t.contains(a))&&(a=K(o,i),a.nodeType===n&&a.length))return!1;return je=oe(ne(e,t)),je.currentNode=a,!je.previousNode()}},re=(e,t)=>{let a,o=e.endContainer,i=e.endOffset;if(je=oe(ne(e,t)),o.nodeType===n){if(a=o.data.length,a&&i<a)return!1;je.currentNode=o}else je.currentNode=K(o,i);return!je.nextNode()},se=e=>{},le=(t,n,a,o)=>{if(t instanceof Range)return t.cloneRange();let i=e.createRange();return i.setStart(t,n),a?i.setEnd(a,o):i.setEnd(t,n),i},de=e=>(t,n)=>{n.preventDefault(),t[e]()},ce=(e,t)=>(n,a)=>{a.preventDefault(),n.toggleTag(e,t)},he=(e,t)=>{try{t||(t=e.getSelection());let o,i=t.startContainer;for(i.nodeType===n&&(i=i.parentNode),o=i;N(o)&&(!o.textContent||o.textContent===a);)i=o,o=i.parentNode;i!==o&&(t.setStart(o,p(o.childNodes,i)),t.collapse(!0),i.remove(),C(o)||(o=x(o,e._root)),j(o,e._root),J(t)),i===e._root&&(i=i.firstChild)&&"BR"===i.nodeName&&U(i),e._ensureBottomLine(),e.setSelection(t),e._updatePath(t,!0)}catch(e){se(e)}},ue=(e,t)=>{let n;for(;(n=e.parentNode)&&n!==t&&!n.isContentEditable;)e=n;U(e)},fe=(t,o,i)=>{let r,s,l,c,h,u=t._root;if(t._recordUndoState(i,!1),t._config.addLinks&&Fe(i.startContainer,u,t),t._removeZWS(),t._getRangeAndRemoveBookmark(i),i.collapsed||Z(i,u),r=ne(i,u),r&&(s=D(r,u,"PRE")))return J(i),l=i.startContainer,c=i.startOffset,l.nodeType!==n&&(l=e.createTextNode(""),s.insertBefore(l,s.firstChild)),o||"\n"!==l.data.charAt(c-1)&&!ie(i,u)||"\n"!==l.data.charAt(c)&&!re(i,u)?(l.insertData(c,"\n"),j(s),l.length===c+1?i.setStartAfter(l):i.setStart(l,c+1)):(l.deleteData(c&&c-1,c?2:1),h=q(l,c&&c-1,u,u),l=h.previousSibling,l.textContent||U(l),l=t.createDefaultBlock(),h.before(l),h.textContent||U(h),i.setStart(l,0)),i.collapse(!0),t.setSelection(i),t._updatePath(i,!0),void t._docWasChanged();if(!r||o||/^T[HD]$/.test(r.nodeName))return te(i,0,u),Q(i,F("BR")),i.collapse(!1),t.setSelection(i),void t._updatePath(i,!0);if(r=D(r,u,"LI")||r,O(r)&&(s=D(r,u,"UL,OL,BLOCKQUOTE")))return"BLOCKQUOTE"===s.nodeName?t.modifyBlocks((()=>t.createDefaultBlock(Re(t))),i):t.decreaseListLevel(i);for(h=Ie(t,r,i.startContainer,i.startOffset),Ae(r),Ce(r),j(r);y(h);){let t,o=h.firstChild;if("A"===h.nodeName&&(!h.textContent||h.textContent===a)){o=e.createTextNode(""),h.replaceWith(o),h=o;break}for(;o?.nodeType===n&&!o.data&&(t=o.nextSibling,t&&"BR"!==t.nodeName);)U(o),o=t;if(!o||"BR"===o.nodeName||o.nodeType===n)break;h=o}i=le(h,0),t.setSelection(i),t._updatePath(i,!0)},pe=e=>(t,n)=>{n.preventDefault(),t.changeIndentationLevel(e)},ge=(e,t)=>(n,a)=>{a.preventDefault();let o=n.getSelectionClosest("UL,OL");e==o?.nodeName?n.removeList():n[t]()},me={1:"x-small",2:"small",3:"medium",4:"large",5:"x-large",6:"xx-large",7:"xxx-large","-1":"smaller","+1":"larger"},ve={fontWeight:{regexp:/^bold|^700/i,replace:()=>F("B")},fontStyle:{regexp:/^italic/i,replace:()=>F("I")},fontFamily:{regexp:f,replace:(e,t)=>F("SPAN",{style:"font-family:"+t})},fontSize:{regexp:f,replace:(e,t)=>F("SPAN",{style:"font-size:"+t})},textDecoration:{regexp:/^underline/i,replace:()=>F("U")}},be=e=>t=>{let n=F(e);return Array.prototype.forEach.call(t.attributes,(e=>n.setAttribute(e.name,e.value))),t.replaceWith(n),n.append(P(t)),n},ye={SPAN:t=>{let n,a,o,i,r=t.style;return Object.entries(ve).forEach((([s,l])=>{if(n=r[s],n&&l.regexp.test(n)){if(i=l.replace(e,n),i.nodeName===t.nodeName&&i.className===t.className)return;o||(o=i),a&&a.append(i),a=i,t.style[s]=""}})),o&&(a.append(P(t)),t.append(o)),a||t},STRONG:be("B"),EM:be("I"),INS:be("U"),STRIKE:be("S"),FONT:e=>{let t=e.face,n=e.size,a=e.color,o=F("SPAN"),i=o.style;return o.style.cssText=e.style.cssText,t&&(i.fontFamily=t),n&&(i.fontSize=me[n]),a&&/^#?([\dA-F]{3}){1,2}$/i.test(a)&&("#"!==a.charAt(0)&&(a="#"+a),i.color=a),e.replaceWith(o),o.append(P(e)),o},TT:e=>{let t=F("SPAN",{style:'font-family:menlo,consolas,"courier new",monospace'});return e.replaceWith(t),t.append(P(e)),t}},Se=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|COL(?:GROUP)?|UL)$/,Ee=/^(?:HEAD|META|STYLE)/,Ne=(e,t)=>{let n,a,o,i,r,s,l,c=e.childNodes;for(n=e;N(n);)n=n.parentNode;for(a=0,o=c.length;a<o;++a)if(i=c[a],r=i.nodeName,s=i.nodeType,1===s){if(l=i.childNodes.length,ye[r])i=ye[r](i);else{if(Ee.test(r)){i.remove(),--a,--o;continue}if(!Se.test(r)&&!N(i)){--a,o+=l-1,i.replaceWith(P(i));continue}}l&&Ne(i,t||"PRE"===r)}return e},Ce=e=>{let t,a=e.childNodes,o=a.length;for(;o--;)t=a[o],y(t)&&!S(t)?(Ce(t),!t.firstChild&&N(t)&&t.remove()):t.nodeType!==n||t.data||t.remove()},_e=e=>y(e)?"BR"===e.nodeName:f.test(e.data),Te=(e,t)=>{let n,a=e.parentNode;for(;N(a);)a=a.parentNode;return n=T(a,5,_e),n.currentNode=e,!!n.nextNode()||t&&!n.previousNode()},Le=(e,t,n)=>{let a,o,i=e.querySelectorAll("BR"),r=i.length;for(;r--;)a=i[r],o=a.parentNode,o&&(Te(a,n)?N(o)||H(o,t):U(a))},xe=(t,n,a)=>{let i,r,s=t.clipboardData,l=e.body,c=F("div");c.append(n),i=c.innerHTML,Le(c,a,!0),c.setAttribute("style","position:fixed;overflow:hidden;bottom:100%;right:100%;"),l.append(c),r=(c.innerText||c.textContent).replace(o," "),c.remove(),r!==i&&s.setData("text/html",i),s.setData("text/plain",r),t.preventDefault()},ke=(e,t,n)=>(e=e||{},t&&Object.entries(t).forEach((([t,a])=>{!n&&t in e||(e[t]=a?.constructor===Object?ke(e[t],a,n):a)})),e),Oe={pathChange:1,select:1,input:1,undoStateChange:1},Ae=(e,t)=>{let n,o,i,r=T(e,4);for(;o=r.nextNode();)for(;(i=o.data.indexOf(a))>-1&&(!t||o.parentNode!==t);){if(1===o.length){do{n=o.parentNode,o.remove(),o=n,r.currentNode=n}while(N(o)&&!I(o));break}o.deleteData(i,1)}},we="squire-selection-start",De="squire-selection-end",Re=()=>[F("INPUT",{id:we,type:"hidden"}),F("INPUT",{id:De,type:"hidden"})],Be={DT:"DD",DD:"DT",LI:"LI",PRE:"PRE"},Ie=(e,n,a,o)=>{let i=Be[n.nodeName]||t,r=q(a,o,n.parentNode,e._root);return w(r,i)||(n=F(i),r.dir&&(n.dir=r.dir),r.replaceWith(n),n.append(P(r)),r=n),r},Ue=(e,t)=>{let n=e.commonAncestorContainer,a=e.startContainer,o=e.endContainer;for(;n&&n!==t&&!/^[OU]L$/.test(n.nodeName);)n=n.parentNode;if(!n||n===t)return null;for(a===n&&(a=a.childNodes[e.startOffset]),o===n&&(o=o.childNodes[e.endOffset]);a&&a.parentNode!==n;)a=a.parentNode;for(;o&&o.parentNode!==n;)o=o.parentNode;return[n,a,o]},Pe=(e,t,n)=>{let a,o,i,r,s=L(t,e._root);for(;a=s.nextNode();)"LI"===a.parentNode.nodeName&&(a=a.parentNode,s.currentNode=a.lastChild),"LI"!==a.nodeName?(r=F("LI"),a.dir&&(r.dir=a.dir),(i=a.previousSibling)&&i.nodeName===n?(i.append(r),U(a)):a.replaceWith(F(n,null,[r])),r.append(P(a)),s.currentNode=r):(a=a.parentNode,o=a.nodeName,o!==n&&/^[OU]L$/.test(o)&&a.replaceWith(F(n,null,[P(a)])));return t},Me=/\b(?:((https?:\/\/)?(?:www\d{0,3}\.|[a-z0-9][a-z0-9.-]*\.[a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:[^\s?&`!()[\]{};:'".,<>«»“”‘’]|\([^\s()<>]+\)))|([\w\-.%+]+@(?:[\w-]+\.)+[a-z]{2,}\b(?:\?[^&?\s]+=[^\s?&`!()[\]{};:'".,<>«»“”‘’]+(?:&[^&?\s]+=[^\s?&`!()[\]{};:'".,<>«»“”‘’]+)*)?))/i,Fe=(t,n)=>{let a,o,i,r,s,l,c,h=T(t,4,(e=>!D(e,n,"A")));for(;a=h.nextNode();)for(o=a.data,i=a.parentNode;r=Me.exec(o);)s=r.index,l=s+r[0].length,s&&(c=e.createTextNode(o.slice(0,s)),i.insertBefore(c,a)),c=F("A",{href:r[1]?r[2]?r[1]:"https://"+r[1]:"mailto:"+r[0]},[o.slice(s,l)]),i.insertBefore(c,a),a.data=o=o.slice(l)};let je,He=new WeakMap;function qe(e){if(e.defaultPrevented)return;let t=e.key.toLowerCase(),n="",a=this.getSelection(),o=this._root;if("backspace"!==t&&"delete"!==t&&(e.altKey&&(n+="alt-"),e[u]&&(n+=h),e.shiftKey&&(n+="shift-")),t=n+t,this._keyHandlers[t])this._keyHandlers[t](this,e,a);else if(a.collapsed||e.isComposing||e[u]||1!==t.length){if(a.collapsed&&a.startContainer===o&&o.children.length>0){const e=o.children[a.startOffset];if(e&&!C(e)){a=le(o.insertBefore(this.createDefaultBlock(),e),0),"BR"===e.tagName&&o.removeChild(e);const t=this._restoreSelection;this.setSelection(a),this._restoreSelection=t}}}else this.saveUndoState(a),Z(a,o),this._ensureBottomLine(),this.setSelection(a),this._updatePath(a,!0)}function $e(e){let t,a,o,i,r,s,l=this.getSelection(),c=this._root,h=this;if(l.collapsed)e.preventDefault();else{if(this.saveUndoState(l),e.clipboardData){for(t=ne(l,c),a=ae(l,c),o=t===a&&t||c,i=Z(l,c),r=l.commonAncestorContainer,r.nodeType===n&&(r=r.parentNode);r&&r!==o;)s=r.cloneNode(!1),s.append(i),i=s,r=r.parentNode;xe(e,i,c)}else setTimeout((()=>{try{h._ensureBottomLine()}catch(e){se(e)}}),0);this.setSelection(l)}}function We(e){if(e.clipboardData){let t,a,o,i=this.getSelection(),r=this._root,s=ne(i,r),l=s===ae(i,r)&&s||r;for(i=i.cloneRange(),J(i),ee(i,l,l,r),t=i.cloneContents(),a=i.commonAncestorContainer,a.nodeType===n&&(a=a.parentNode);a&&a!==l;)o=a.cloneNode(!1),o.append(t),t=o,a=a.parentNode;xe(e,t,r)}}function Ve(e){let t,n=e.clipboardData,a=n?.items,o=null,i=null,r=null,s=this;if(a&&([...a].forEach((e=>{t=e.type,"text/html"===t?r=e:"text/plain"===t||"text/uri-list"===t?i=e:"file"===e.kind&&/^image\/(png|jpeg|webp)/.test(t)&&(o=e)})),r||i||o))if(e.preventDefault(),o){let e=new FileReader;e.onload=e=>{let t=F("img",{src:e.target.result}),n=F("canvas"),a=n.getContext("2d");t.onload=()=>{a.drawImage(t,0,0);let e=t.width,o=t.height;e>o?e>1024&&(o=1024*o/e,e=1024):o>1024&&(e=1024*e/o,o=1024),n.width=e,n.height=o,a.drawImage(t,0,0,e,o),s.insertHTML('<img alt="" style="width:100%;max-width:'+e+'px" src="'+n.toDataURL()+'">',!0)}},e.readAsDataURL(o.getAsFile())}else!r||s.isShiftDown&&i?i&&i.getAsString((e=>s.insertPlainText(e,!0))):r.getAsString((e=>s.insertHTML(e,!0)))}function ze(e){let t=e.dataTransfer.types;(t.includes("text/plain")||t.includes("text/html"))&&this.saveUndoState()}let Ke={enter:l?(e,t,n)=>{e._saveRangeToBookmark(n);let a=e._getHTML(),o=()=>{e.removeEventListener("keyup",o),e._setHTML(a),n=e._getRangeAndRemoveBookmark(),fe(e,!1,n)};e.addEventListener("keyup",o)}:(e,t,n)=>{t.preventDefault(),fe(e,t.shiftKey,n)},"shift-enter":(e,t,n)=>e._keyHandlers.enter(e,t,n),backspace:(e,t,n)=>{let a=e._root;if(e._removeZWS(),e.saveUndoState(n),n.collapsed)if(ie(n,a)){t.preventDefault();let o,i=ne(n,a);if(!i)return;if(H(i.parentNode,a),o=x(i,a),o){if(!o.isContentEditable)return void ue(o,a);for(V(o,i,n,a),i=o.parentNode;i!==a&&!i.nextSibling;)i=i.parentNode;i!==a&&(i=i.nextSibling)&&z(i,a),e.setSelection(n)}else if(i){let t=D(i,a,"UL,OL,BLOCKQUOTE");if(t)return"BLOCKQUOTE"===t.nodeName?e.decreaseQuoteLevel(n):e.decreaseListLevel(n);e.setSelection(n),e._updatePath(n,!0)}}else e.setSelection(n),setTimeout((()=>he(e)),0);else t.preventDefault(),Z(n,a),he(e,n)},delete:(e,t,n)=>{let a,o,i,r,s,l,c=e._root;if(e._removeZWS(),e.saveUndoState(n),n.collapsed)if(re(n,c)){if(t.preventDefault(),(a=ne(n,c))&&(H(a.parentNode,c),o=k(a,c))){if(!o.isContentEditable)return void ue(o,c);for(V(a,o,n,c),o=a.parentNode;o!==c&&!o.nextSibling;)o=o.parentNode;o!==c&&(o=o.nextSibling)&&z(o,c),e.setSelection(n),e._updatePath(n,!0)}}else{if(i=n.cloneRange(),ee(n,c,c,c),r=n.endContainer,s=n.endOffset,y(r)&&(l=r.childNodes[s],"IMG"===l?.nodeName))return t.preventDefault(),U(l),J(n),void he(e,n);e.setSelection(i),setTimeout((()=>he(e)),0)}else t.preventDefault(),Z(n,c),he(e,n)},tab:(e,t,n)=>{let a,o,i=e._root;if(e._removeZWS(),n.collapsed&&ie(n,i))for(a=ne(n,i);o=a.parentNode;){if("UL"===o.nodeName||"OL"===o.nodeName){t.preventDefault(),e.increaseListLevel(n);break}a=o}},"shift-tab":(e,t,n)=>{let a,o=e._root;e._removeZWS(),n.collapsed&&ie(n,o)&&(a=n.startContainer,D(a,o,"UL,OL")&&(t.preventDefault(),e.decreaseListLevel(n)))},space:(e,t,n)=>{let a=e._root;e._recordUndoState(n,!1),e._config.addLinks&&Fe(n.startContainer,a,e),e._getRangeAndRemoveBookmark(n),n.collapsed||(Z(n,a),e._ensureBottomLine(),e.setSelection(n),e._updatePath(n,!0)),e.setSelection(n)},arrowleft:e=>e._removeZWS(),arrowright:e=>e._removeZWS()};function Ge(e,t){let n=e._root,a=le(n,t?0:n.childNodes.length);return J(a),e.setSelection(a),e}s||(Ke.pageup=e=>Ge(e,!0),Ke.pagedown=e=>Ge(e,!1)),Ke[h+"b"]=ce("B"),Ke[h+"i"]=ce("I"),Ke[h+"u"]=ce("U"),Ke[h+"shift-7"]=ce("S"),Ke[h+"shift-5"]=ce("SUB","SUP"),Ke[h+"shift-6"]=ce("SUP","SUB"),Ke[h+"shift-8"]=ge("UL","makeUnorderedList"),Ke[h+"shift-9"]=ge("OL","makeOrderedList"),Ke[h+"["]=pe("decrease"),Ke[h+"]"]=pe("increase"),Ke[h+"d"]=de("toggleCode"),Ke[h+"y"]=de("redo"),Ke.redo=de("redo"),Ke[h+"z"]=de("undo"),Ke.undo=de("undo"),Ke[h+"shift-z"]=de("redo");class EditStack extends Array{constructor(e){super(),this.squire=e,this.index=-1,this.inUndoState=!1,this.threshold=-1,this.limit=-1}clear(){this.index=-1,this.length=0}stateChanged(){this.squire.fireEvent("undoStateChange",{canUndo:this.index>0,canRedo:this.index+1<this.length}),this.squire.fireEvent("input")}docWasChanged(){this.inUndoState?(this.inUndoState=!1,this.stateChanged()):this.squire.fireEvent("input")}recordUndoState(e,t){if(t=!1!==t&&this.inUndoState,!this.inUndoState||t){let n,a=this.index,o=this.threshold,i=this.limit,r=this.squire;t||++a,a=Math.max(0,a),this.length=Math.min(a+1,this.length),e&&r._saveRangeToBookmark(e),n=r._getHTML(),o>-1&&2*n.length>o&&i>-1&&a>i&&this.splice(0,a-i),this[a]=n,this.index=a,this.inUndoState=!0}}saveUndoState(e){let t=this.squire;void 0===e&&(e=t.getSelection()),this.recordUndoState(e),t._getRangeAndRemoveBookmark(e)}undo(){let e=this.squire,t=this.index-1;if(t>=0||!this.inUndoState){this.recordUndoState(e.getSelection(),!1),this.index=t,e._setHTML(this[t]);let n=e._getRangeAndRemoveBookmark();n&&e.setSelection(n),this.inUndoState=!0,this.stateChanged()}}redo(){let e=this.squire,t=this.index+1;if(t<this.length&&this.inUndoState){this.index=t,e._setHTML(this[t]);let n=e._getRangeAndRemoveBookmark();n&&e.setSelection(n),this.stateChanged()}}}i.Squire=class Squire{constructor(t,n){let a;this._root=t,this._events={},this._isFocused=!1,this._lastRange=null,this._hasZWS=!1,this._lastAnchorNode=null,this._lastFocusNode=null,this._path="";const o=()=>{t.contains(e.activeElement)?this._isFocused&&!a&&(a=setTimeout((()=>{a=0,this._updatePath(this.getSelection())}),0)):this.removeEventListener("selectionchange",o)};this.addEventListener("selectstart",(()=>this.addEventListener("selectionchange",o))),this.editStack=new EditStack(this),this._ignoreChange=!1,this._ignoreAllChanges=!1,this._mutation=new MutationObserver((()=>this._docWasChanged())),this._mutation.observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._restoreSelection=!1,this.addEventListener("blur",(()=>this._restoreSelection=!0)).addEventListener("pointerdown mousedown touchstart",(()=>this._restoreSelection=!1)).addEventListener("focus",(()=>this._restoreSelection&&this.setSelection(this._lastRange))).addEventListener("cut",$e).addEventListener("copy",We).addEventListener("keydown keyup",(e=>this.isShiftDown=e.shiftKey)).addEventListener("paste",Ve).addEventListener("drop",ze).addEventListener("keydown",qe).addEventListener("pointerup keyup mouseup touchend",(()=>this.getSelection())),this._keyHandlers=Object.create(Ke),this.setConfig(n),t.setAttribute("contenteditable","true"),t.setAttribute("data-gramm","false");try{e.execCommand("enableObjectResizing",!1,"false"),e.execCommand("enableInlineTableEditing",!1,"false")}catch(e){}t.__squire__=this,this.setHTML("")}setConfig(e){return this._config=ke({addLinks:!0},e,!0),this}createDefaultBlock(e){return j(F(t,null,e),this._root)}getRoot(){return this._root}fireEvent(t,n){let a,o,i,r=this._events[t];if(/^(?:focus|blur)/.test(t))if(a=this._root===e.activeElement,"focus"===t){if(!a||this._isFocused)return this;this._isFocused=!0}else{if(a||!this._isFocused)return this;this._isFocused=!1}if(r)for((n=n||{}).type!==t&&(n.type=t),r=r.slice(),o=r.length;o--;){i=r[o];try{i.handleEvent?i.handleEvent(n):i.call(this,n)}catch(e){e.details="Squire: fireEvent error. Event type: "+t,se(e)}}return this}handleEvent(e){this.fireEvent(e.type,e)}addEventListener(t,n){return t.split(/\s+/).forEach((t=>{if(!n)return se({name:"Squire: addEventListener with null or undefined fn",message:"Event type: "+t}),this;let a=this._events[t];a||(a=this._events[t]=[],Oe[t]||("selectionchange"===t?e:this._root).addEventListener(t,this,{capture:!0,passive:"touchstart"===t})),a.push(n)})),this}removeEventListener(t,n){let a,o=this._events[t];if(o){if(n)for(a=o.length;a--;)o[a]===n&&o.splice(a,1);else o.length=0;o.length||(delete this._events[t],Oe[t]||("selectionchange"===t?e:this._root).removeEventListener(t,this,!0))}return this}setSelection(e){if(e)if(this._lastRange=e,this._isFocused){l&&i.focus();let t=i.getSelection();t?.setBaseAndExtent?t.setBaseAndExtent(e.startContainer,e.startOffset,e.endContainer,e.endOffset):t&&(t.removeAllRanges(),t.addRange(e))}else this._restoreSelection=!0;return this}getSelection(){let t,n,a,o=i.getSelection(),r=this._root;return this._isFocused&&o?.rangeCount&&(t=o.getRangeAt(0).cloneRange(),n=t.startContainer,a=t.endContainer,n&&S(n)&&t.setStartBefore(n),a&&S(a)&&t.setEndBefore(a)),t&&r.contains(t.commonAncestorContainer)?this._lastRange=t:(t=this._lastRange,e.contains(t.commonAncestorContainer)||(t=null)),t||le(r.firstChild,0)}getSelectionClosest(e){let t=this.getSelection();return t&&D(t.commonAncestorContainer,this._root,e)}getPath(){return this._path}_addZWS(){return this._hasZWS=c,e.createTextNode(c?a:"")}_removeZWS(){this._hasZWS&&(Ae(this._root),this._hasZWS=!1)}_updatePath(e,t){if(e){let n,a,o=e.startContainer,i=e.endContainer;(t||o!==this._lastAnchorNode||i!==this._lastFocusNode)&&(this._lastAnchorNode=o,this._lastFocusNode=i,a=o===i?i:null,n=o&&i?a?B(i,this._root):"(selection)":"",this._path!==n&&(this._path=n,this.fireEvent("pathChange",{path:n,element:!a||y(a)?a:a.parentElement}))),this.fireEvent(e.collapsed?"cursor":"select",{range:e})}}focus(){return this._root.focus({preventScroll:!0}),this}blur(){return this._root.blur(),this}_saveRangeToBookmark(e){let t,[n,a]=Re(this);Q(e,n),e.collapse(!1),Q(e,a),2&n.compareDocumentPosition(a)&&(n.id=De,a.id=we,t=n,n=a,a=t),e.setStartAfter(n),e.setEndBefore(a)}_getRangeAndRemoveBookmark(t){let a=this._root,o=a.querySelector("#"+we),i=a.querySelector("#"+De);if(o&&i){let a=o.parentNode,r=i.parentNode,s=p(a.childNodes,o),l=p(r.childNodes,i);a===r&&--l,U(o),U(i),t||(t=e.createRange()),t.setStart(a,s),t.setEnd(r,l),W(a,t),a!==r&&W(r,t),t.collapsed&&(a=t.startContainer,a.nodeType===n&&(r=a.childNodes[t.startOffset],r&&r.nodeType===n||(r=a.childNodes[t.startOffset-1]),r?.nodeType===n&&(t.setStart(r,0),t.collapse(!0))))}return t||null}_docWasChanged(){He=new WeakMap,this._ignoreAllChanges||(this._ignoreChange?this._ignoreChange=!1:this.editStack.docWasChanged())}_recordUndoState(e,t){this.editStack.recordUndoState(e,t)}saveUndoState(e){this.editStack.saveUndoState(e)}undo(){this.editStack.undo()}redo(){this.editStack.redo()}hasFormat(e,t,a){if(e=e.toUpperCase(),!a&&!(a=this.getSelection()))return!1;!a.collapsed&&a.startContainer.nodeType===n&&a.startOffset===a.startContainer.length&&a.startContainer.nextSibling&&a.setStartBefore(a.startContainer.nextSibling),!a.collapsed&&a.endContainer.nodeType===n&&0===a.endOffset&&a.endContainer.previousSibling&&a.setEndAfter(a.endContainer.previousSibling);let o,i,r=this._root,s=a.commonAncestorContainer;if(R(s,r,e,t))return!0;if(s.nodeType===n)return!1;o=T(s,4,(e=>Y(a,e)));let l=!1;for(;i=o.nextNode();){if(!R(i,r,e,t))return!1;l=!0}return l}getFontInfo(e){let t,a,o,i={color:void 0,backgroundColor:void 0,family:void 0,size:void 0},r=0;if(!e&&!(e=this.getSelection()))return i;if(t=e.commonAncestorContainer,e.collapsed||t.nodeType===n)for(t.nodeType===n&&(t=t.parentNode);r<4&&t;)(a=t.style)&&(!i.color&&(o=a.color)&&(i.color=o,++r),!i.backgroundColor&&(o=a.backgroundColor)&&(i.backgroundColor=o,++r),!i.family&&(o=a.fontFamily)&&(i.family=o,++r),!i.size&&(o=a.fontSize)&&(i.size=o,++r)),t=t.parentNode;return i}_addFormat(e,t,a){let o,i,r,s,l,c,h,u,f=this._root;if(a.collapsed){for(o=j(F(e,t)),Q(a,o),a.setStart(o.firstChild,o.firstChild.length),a.collapse(!0),u=o;N(u);)u=u.parentNode;Ae(u,o)}else if(i=T(a.commonAncestorContainer,5,(e=>(e.nodeType===n||"BR"===e.nodeName||"IMG"===e.nodeName)&&Y(a,e))),r=a.startContainer,l=a.startOffset,s=a.endContainer,c=a.endOffset,i.currentNode=r,g!=i.filter.acceptNode(r)&&(r=i.nextNode(),l=0),r){do{h=i.currentNode,R(h,f,e,t)||(h===s&&h.length>c&&h.splitText(c),h===r&&l&&(h=h.splitText(l),s===r&&(s=h,c-=l),r=h,l=0),o=F(e,t),h.replaceWith(o),o.append(h))}while(i.nextNode());s.nodeType!==n&&(h.nodeType===n?(s=h,c=h.length):(s=h.parentNode,c=1)),a=le(r,l,s,c)}return a}_removeFormat(e,t,a,o){let i;this._saveRangeToBookmark(a),a.collapsed&&(i=this._addZWS(),Q(a,i));let r=a.commonAncestorContainer;for(;N(r);)r=r.parentNode;let s=a.startContainer,l=a.startOffset,c=a.endContainer,h=a.endOffset,u=[],f=(e,t)=>{if(Y(a,e,!1))return;let o,i,r=e.nodeType===n;if(Y(a,e))if(r)e===c&&h!==e.length&&u.push([t,e.splitText(h)]),e===s&&l&&(e.splitText(l),u.push([t,e]));else for(o=e.firstChild;o;o=i)i=o.nextSibling,f(o,t);else"INPUT"===e.nodeName||r&&!e.data||u.push([t,e])},p=Array.prototype.filter.call(r.getElementsByTagName(e),(n=>Y(a,n)&&w(n,e,t)));return o||p.forEach((e=>f(e,e))),u.forEach((([e,t])=>{let n=e.cloneNode(!1);t.replaceWith(n),n.append(t)})),p.forEach((e=>e.replaceWith(P(e)))),this._getRangeAndRemoveBookmark(a),i&&a.collapse(!1),W(r,a),a}toggleTag(e,t){let n=this.getSelection();this.hasFormat(e,null,n)?this.changeFormat(null,{tag:e},n):this.changeFormat({tag:e},t?{tag:t}:null,n)}changeFormat(e,t,n,a){return(n||(n=this.getSelection()))&&(this.saveUndoState(n),t&&(n=this._removeFormat(t.tag.toUpperCase(),t.attributes||{},n,a)),e&&(n=this._addFormat(e.tag.toUpperCase(),e.attributes||{},n)),this.setSelection(n),this._updatePath(n,!0)),this}forEachBlock(e,t){if(t||(t=this.getSelection())){this.saveUndoState(t);let n=this._root,a=ne(t,n),o=ae(t,n);if(a&&o)do{if(e(a)||a===o)break}while(a=k(a,n));this.setSelection(t),this._updatePath(t,!0)}return this}modifyBlocks(e,t){if(t||(t=this.getSelection())){this._recordUndoState(t);let n,a=this._root;((e,t)=>{let n=ne(e,t),a=ae(e,t);n&&a&&(e.setStart(n,0),e.setEnd(a,a.childNodes.length))})(t,a),ee(t,a,a,a),n=X(t,a,a),Q(t,e.call(this,n)),t.endOffset<t.endContainer.childNodes.length&&z(t.endContainer.childNodes[t.endOffset],a),z(t.startContainer.childNodes[t.startOffset],a),this._getRangeAndRemoveBookmark(t),this.setSelection(t),this._updatePath(t,!0)}return this}increaseListLevel(e){if(e||(e=this.getSelection())){let t=this._root,n=Ue(e,t);if(n){let a=n[0],o=n[1],i=n[2];if(o&&o!==a.firstChild){this._recordUndoState(e);let n,r=a.nodeName,s=o.previousSibling;s.nodeName!==r&&(s=F(r),o.before(s));do{n=o===i?null:o.nextSibling,s.append(o)}while(o=n);n=s.nextSibling,n&&z(n,t),this._getRangeAndRemoveBookmark(e),this.setSelection(e),this._updatePath(e,!0)}}}return this.focus()}decreaseListLevel(e){if(e||(e=this.getSelection())){let t=this._root,n=Ue(e,t);if(n){let a,o,i,r,s=n[0],l=n[1]||s.firstChild,c=n[2]||s.lastChild;if(this._recordUndoState(e),l){if(a=s.parentNode,i=c.nextSibling?q(s,c.nextSibling,a,t):s.nextSibling,a!==t&&"LI"===a.nodeName){for(a=a.parentNode;i;)o=i.nextSibling,c.append(i),i=o;i=s.parentNode.nextSibling}r=!/^[OU]L$/.test(a.nodeName);do{o=l===c?null:l.nextSibling,l.remove(),r&&"LI"===l.nodeName&&(l=this.createDefaultBlock([P(l)])),a.insertBefore(l,i)}while(l=o)}s.firstChild||U(s),i&&z(i,t),this._getRangeAndRemoveBookmark(e),this.setSelection(e),this._updatePath(e,!0)}}return this.focus()}_ensureBottomLine(){let e=this._root,n=e.lastElementChild;n&&n.nodeName===t&&C(n)||e.append(this.createDefaultBlock())}_getHTML(){return this._root.innerHTML}_setHTML(e){let t=this._root,n=t;P(t),t.appendChild(this._config.sanitizeToDOMFragment(e,!1));do{j(n)}while(n=k(n,t));this._ignoreChange=!0}getHTML(e){let t,n;return e&&(n=this.getSelection())&&this._saveRangeToBookmark(n),t=this._getHTML().replace(/\u200B/g,""),n&&this._getRangeAndRemoveBookmark(n),t}setHTML(e){let t,n=this._root,a=this._config.sanitizeToDOMFragment(e,!1);Ne(a),Le(a,n,!1),H(a,n);let o,i=L(a,n);for(;(o=i.nextNode())&&o!==n;)j(o);for(this._ignoreChange=!0;t=n.lastChild;)t.remove();n.append(a),j(n),this.editStack.clear();let r=this._getRangeAndRemoveBookmark()||le(n.firstChild,0);return this.saveUndoState(r),this._lastRange=r,this._restoreSelection=!0,this._updatePath(r,!0),this}insertElement(e,t){if(t||(t=this.getSelection()),t.collapse(!0),N(e))Q(t,e),t.setStartAfter(e);else{let n,a,o=this._root,i=ne(t,o)||o;for(;i!==o&&!i.nextSibling;)i=i.parentNode;i!==o&&(n=i.parentNode,a=q(n,i.nextSibling,o,o)),a?a.before(e):(o.append(e),a=this.createDefaultBlock(),o.append(a)),t.setStart(a,0),t.setEnd(a,0),J(t)}return this.focus(),this.setSelection(t),this._updatePath(t),this}insertImage(e,t){let n=F("IMG",ke({src:e},t,!0));return this.insertElement(n),n}insertHTML(t,n){let a=this.getSelection();if(n){let e=t.indexOf("\x3c!--StartFragment--\x3e"),n=t.lastIndexOf("\x3c!--EndFragment--\x3e");e>-1&&n>-1&&(t=t.slice(e+20,n))}let o=this._config.sanitizeToDOMFragment(t,n);this.saveUndoState(a);try{let t=this._root,i=o;for(Fe(o,o,this),Ne(o),Le(o,t,!1),Ce(o),o.normalize();i=k(i,o);)j(i);((t,n,a)=>{let o,i,r,s,l,c,h,u,f,g,m,v=n.firstChild&&N(n.firstChild);for(H(n,a),o=n;o=k(o,a);)j(o);if(t.collapsed||Z(t,a),J(t),t.collapse(!1),s=D(t.endContainer,a,"BLOCKQUOTE")||a,i=ne(t,a),u=k(n,n),h=!v&&!!i&&O(i),i&&u&&!h&&!D(u,n,"PRE,TABLE")){if(ee(t,i,i,a),t.collapse(!0),l=t.endContainer,c=t.endOffset,Le(i,a,!1),N(l)&&(f=q(l,c,x(l,a),a),l=f.parentNode,c=p(l.childNodes,f)),c!==I(l))for(r=e.createDocumentFragment();o=l.childNodes[c];)r.append(o);V(l,u,t,a),c=p(l.parentNode.childNodes,l)+1,l=l.parentNode,t.setEnd(l,c)}I(n)&&(h&&(t.setEndBefore(i),t.collapse(!1),U(i)),ee(t,s,s,a),f=q(t.endContainer,t.endOffset,s,a),g=f?f.previousSibling:s.lastChild,s.insertBefore(n,f),f?t.setEndBefore(f):t.setEnd(s,I(s)),i=ae(t,a),J(t),l=t.endContainer,c=t.endOffset,f&&_(f)&&z(f,a),f=g?.nextSibling,f&&_(f)&&z(f,a),t.setEnd(l,c)),r&&(m=t.cloneRange(),V(i,r,m,a),t.setEnd(m.endContainer,m.endOffset)),J(t)})(a,o,t),a.collapse(!1),te(a,0,t),this._ensureBottomLine(),this.setSelection(a),this._updatePath(a,!0),n&&this.focus()}catch(e){se(e)}return this}insertPlainText(t,a){let i=this.getSelection();if(i.collapsed&&D(i.startContainer,this._root,"PRE")){let a,o=i.startContainer,r=i.startOffset;return o?.nodeType!==n&&(a=e.createTextNode(""),o?.childNodes[r].before(a),o=a,r=0),o.insertData(r,t),i.setStart(o,r+t.length),i.collapse(!0),this.setSelection(i),this}let r=t.split(/\r?\n/);return r.forEach(((e,t)=>{var n;e=(n=e,n.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;")).replace(/ (?=(?: |$))/g,o),r[t]=t?"<DIV>"+(e||"<BR>")+"</DIV>":e})),this.insertHTML(r.join(""),a)}makeLink(t,n){let a=this.getSelection();return a.collapsed&&Q(a,e.createTextNode(t.replace(/^[^:]*:\/*/,""))),n=ke(ke({href:t},n,!0),null,!1),this.changeFormat({tag:"A",attributes:n},{tag:"A"},a),this.focus()}removeLink(){return this.changeFormat(null,{tag:"A"},this.getSelection(),!0),this.focus()}setStyle(e){this.setAttribute("style",e)}setAttribute(e,t){let a=this.getSelection(),o=a?.startContainer||{},i=a?a.endContainer:0;return"dir"==e||n===o?.nodeType&&0===a.startOffset&&o===i&&i.length===a.endOffset?(this.saveUndoState(a),M(o.parentNode,{[e]:t}),this.setSelection(a),this._updatePath(a,!0)):this.changeFormat({tag:"SPAN",attributes:{[e]:t}},null,a),this.focus()}code(){let t=this.getSelection();return t.collapsed||_(t.commonAncestorContainer)?this.modifyBlocks((t=>{let n,a=this._root,i=e.createDocumentFragment(),r=L(t,a);for(;n=r.nextNode();)n.querySelectorAll("BR").forEach((t=>{Te(t,!1)?t.replaceWith(e.createTextNode("\n")):U(t)})),n.querySelectorAll("CODE").forEach((e=>U(e))),i.childNodes.length&&i.append(e.createTextNode("\n")),i.append(P(n));for(r=T(i,4);n=r.nextNode();)n.data=n.data.replace(o," ");return i.normalize(),j(F("PRE",null,[i]))}),t):this.changeFormat({tag:"CODE"},null,t),this.focus()}removeCode(){let t=this.getSelection(),n=t.commonAncestorContainer;return D(n,this._root,"PRE")?this.modifyBlocks((t=>{let n,a,i,r,s,l,c=this._root,h=t.querySelectorAll("PRE"),u=h.length;for(;u--;){for(n=h[u],a=T(n,4);i=a.nextNode();){for(r=i.data,r=r.replace(/ (?=)/g,o),s=e.createDocumentFragment();(l=r.indexOf("\n"))>-1;)s.append(e.createTextNode(r.slice(0,l))),s.append(F("BR")),r=r.slice(l+1);i.before(s),i.data=r}H(n,c),n.replaceWith(P(n))}return t}),t):this.changeFormat(null,{tag:"CODE"},t),this.focus()}toggleCode(){return this.hasFormat("PRE")||this.hasFormat("CODE")?this.removeCode():this.code()}changeIndentationLevel(e){let t=this.getSelectionClosest("UL,OL,BLOCKQUOTE");if(t||"increase"===e){this[e+(t&&"BLOCKQUOTE"!==t.nodeName?"List":"Quote")+"Level"]()}}increaseQuoteLevel(e){return this.modifyBlocks((e=>F("BLOCKQUOTE",null,[e])),e),this.focus()}decreaseQuoteLevel(e){return this.modifyBlocks((e=>(Array.prototype.filter.call(e.querySelectorAll("blockquote"),(t=>!D(t.parentNode,e,"BLOCKQUOTE"))).forEach((e=>e.replaceWith(P(e)))),e)),e),this.focus()}bidi(e){return this.modifyBlocks((t=>((e,t,n)=>{let a,o=L(t,e._root);for(;a=o.nextNode();){if("LI"===a.nodeName){a.parentNode.setAttribute("dir",n);break}a.setAttribute("dir",n)}return t})(this,t,e))),this.focus()}makeUnorderedList(){return this.modifyBlocks((e=>Pe(this,e,"UL"))),this.focus()}makeOrderedList(){return this.modifyBlocks((e=>Pe(this,e,"OL"))),this.focus()}removeList(){return this.modifyBlocks((e=>{let t,n=this._root;return e.querySelectorAll("UL, OL").forEach((e=>{t=P(e),H(t,n),e.replaceWith(t)})),e.querySelectorAll("LI").forEach((e=>{C(e)?e.replaceWith(this.createDefaultBlock([P(e)])):(H(e,n),e.replaceWith(P(e)))})),e})),this.focus()}bold(){this.toggleTag("B")}italic(){this.toggleTag("I")}underline(){this.toggleTag("U")}strikethrough(){this.toggleTag("S")}subscript(){this.toggleTag("SUB","SUP")}superscript(){this.toggleTag("SUP","SUB")}}})(document),(e=>{const t="abbr,align,background,bgcolor,border,cellpadding,cellspacing,class,color,colspan,dir,face,frame,height,href,hspace,id,lang,rowspan,rules,scope,size,src,style,target,type,usemap,valign,vspace,width".split(","),n=(e,t)=>rl.i18n(e)||t,a=shortcuts.getMetaKey()+" + ",o=t=>e.createElement(t),i=o("template"),r=e=>e.trim().replace(/^(<div>\s*<br\s*\/?>\s*<\/div>)+/,"").trim(),s=e=>rl.Utils.htmlToPlain(e).trim(),l=e=>rl.Utils.plainToHtml(e),c=(e,t)=>Object.values(e).forEach(t),h={sanitizeToDOMFragment:(n,a)=>(i.innerHTML=(n||"").replace(/<\/?(BODY|HTML)[^>]*>/gi,"").replace(/<!--[^>]+-->/g,"").replace(/<span[^>]*>\s*<\/span>/gi,"").trim(),i.querySelectorAll("a:empty,span:empty").forEach((e=>e.remove())),a&&(i.querySelectorAll("HEAD,LINK,META,NOSCRIPT,SCRIPT,TEMPLATE,TITLE").forEach((e=>e.remove())),i.querySelectorAll("*").forEach((n=>{n.matches("A,B,BLOCKQUOTE,BR,DIV,FONT,H1,H2,H3,H4,H5,H6,HR,IMG,LI,OL,P,SPAN,STRONG,TABLE,TD,TH,TR,U,UL")?n.hasAttributes()&&[...n.attributes].forEach((e=>{let a=e.name.toLowerCase();t.includes(a)||n.removeAttribute(a)})):n.replaceWith((t=>{let n=e.createDocumentFragment();return n.append(...t.childNodes),n})(n))}))),i.content)};this.SquireUI=class SquireUI{constructor(t){const i=o("input"),r=e=>t=>{i.style.left=t.offsetLeft+t.parentNode.offsetLeft+"px",i.style.width=t.offsetWidth+"px",i.value="",i.onchange=()=>g.setStyle({[e]:i.value}),setTimeout((()=>i.click()),1)},s={mode:{plain:{select:[[n("SETTINGS_GENERAL/EDITOR_HTML"),"wysiwyg"],[n("SETTINGS_GENERAL/EDITOR_PLAIN"),"plain"]],cmd:e=>this.setMode("plain"==e.value?"plain":"wysiwyg")}},font:{fontFamily:{select:{"sans-serif":{Arial:"'Nimbus Sans L', 'Liberation sans', 'Arial Unicode MS', Arial, Helvetica, Garuda, Utkal, FreeSans, sans-serif",Tahoma:"'Luxi Sans', Tahoma, Loma, Geneva, Meera, sans-serif",Trebuchet:"'DejaVu Sans Condensed', Trebuchet, 'Trebuchet MS', sans-serif",Lucida:"'Lucida Sans Unicode', 'Lucida Sans', 'DejaVu Sans', 'Bitstream Vera Sans', 'DejaVu LGC Sans', sans-serif",Verdana:"'DejaVu Sans', Verdana, Geneva, 'Bitstream Vera Sans', 'DejaVu LGC Sans', sans-serif"},monospace:{Courier:"'Liberation Mono', 'Courier New', FreeMono, Courier, monospace",Lucida:"'DejaVu Sans Mono', 'DejaVu LGC Sans Mono', 'Bitstream Vera Sans Mono', 'Lucida Console', Monaco, monospace"},sans:{Times:"'Nimbus Roman No9 L', 'Times New Roman', Times, FreeSerif, serif",Palatino:"'Bitstream Charter', 'Palatino Linotype', Palatino, Palladio, 'URW Palladio L', 'Book Antiqua', Times, serif",Georgia:"'URW Palladio L', Georgia, Times, serif"}},cmd:e=>g.setStyle({fontFamily:e.value})},fontSize:{select:["11px","13px","16px","20px","24px","30px"],defaultValueIndex:2,cmd:e=>g.setStyle({fontSize:e.value})}},dir:{dir_ltr:{html:"⁋",cmd:()=>g.bidi("ltr")},dir_rtl:{html:"¶",cmd:()=>g.bidi("rtl")}},colors:{textColor:{html:"A<sub>▾</sub>",cmd:r("color")},backgroundColor:{html:"🎨",cmd:r("backgroundColor")}},inline:{bold:{html:"B",cmd:()=>this.doAction("bold"),key:"B",matches:"B,STRONT"},italic:{html:"I",cmd:()=>this.doAction("italic"),key:"I",matches:"I"},underline:{html:"<u>U</u>",cmd:()=>this.doAction("underline"),key:"U",matches:"U"},strike:{html:"<s>S</s>",cmd:()=>this.doAction("strikethrough"),key:"Shift + 7",matches:"S"},sub:{html:"Xₙ",cmd:()=>this.doAction("subscript"),key:"Shift + 5",matches:"SUB"},sup:{html:"Xⁿ",cmd:()=>this.doAction("superscript"),key:"Shift + 6",matches:"SUP"}},block:{ol:{html:"#",cmd:()=>this.doList("OL"),key:"Shift + 8",matches:"OL"},ul:{html:"⋮",cmd:()=>this.doList("UL"),key:"Shift + 9",matches:"UL"},quote:{html:'"',cmd:()=>{let e=g.getSelectionClosest("UL,OL,BLOCKQUOTE")?.nodeName;"BLOCKQUOTE"==e?g.decreaseQuoteLevel():g.increaseQuoteLevel()},matches:"BLOCKQUOTE"},indentDecrease:{html:"⇤",cmd:()=>g.changeIndentationLevel("decrease"),key:"]"},indentIncrease:{html:"⇥",cmd:()=>g.changeIndentationLevel("increase"),key:"["}},targets:{link:{html:"🔗",cmd:()=>{let e=g.getSelectionClosest("A"),t=prompt("Link",e?.href||"https://");null!=t&&(t.length?g.makeLink(t):e&&g.removeLink())},matches:"A"},imageUrl:{html:"🖼️",cmd:()=>{let e=g.getSelectionClosest("IMG"),t=prompt("Image",e?.src||"https://");t?.length?g.insertImage(t):e&&g.detach(e)},matches:"IMG"},imageUpload:{html:"📂️",cmd:()=>p.click(),matches:"IMG"}},changes:{undo:{html:"↶",cmd:()=>g.undo(),key:"Z"},redo:{html:"↷",cmd:()=>g.redo(),key:"Y"},source:{html:"👁",cmd:e=>{this.setMode("source"==this.mode?"wysiwyg":"source"),e.classList.toggle("active","source"==this.mode)}}}},l=o("textarea"),u=o("div"),f=o("div"),p=o("input"),g=new Squire(u,h);i.type="color",f.append(i);let m,v,y="squire-colors",S=e.getElementById(y),E=e=>S.append(new Option(e));for(m in S||(S=o("datalist"),S.id=y,E("#4E79A7"),E("#F28E2B"),E("#E15759"),E("#76B7B2"),E("#59A14F"),E("#EDC948"),E("#B07AA1"),E("#FF9DA7"),E("#9C755F"),E("#BAB0AC"),e.body.append(S)),i.setAttribute("list",y),p.type="file",p.accept="image/*",p.style.display="none",p.onchange=()=>{if(p.files.length){let e=new FileReader;e.readAsDataURL(p.files[0]),e.onloadend=()=>e.result&&g.insertImage(e.result)}},l.className="squire-plain",u.className="squire-wysiwyg",u.dir="auto",this.mode="",this.__plain={getRawData:()=>this.plain.value,setRawData:e=>this.plain.value=e},this.container=t,this.squire=g,this.plain=l,this.wysiwyg=u,dispatchEvent(new CustomEvent("squire-toolbar",{detail:{squire:this,actions:s}})),f.className="squire-toolbar btn-toolbar",s){let e=o("div");for(v in e.className="btn-group",e.id="squire-toolgroup-"+m,s[m]){let t,i=s[m][v],r="click";i.input?(t=o("input"),t.type=i.input,r="change"):i.select?(t=o("select"),t.className="btn",Array.isArray(i.select)?i.select.forEach((e=>{e=Array.isArray(e)?e:[e,e];var n=new Option(e[0],e[1]);n.style[v]=e[1],t.append(n)})):Object.entries(i.select).forEach((([e,n])=>{let a=o("optgroup");a.label=e,Object.entries(n).forEach((([e,t])=>{var n=new Option(e,t);n.style[v]=t,a.append(n)})),t.append(a)})),r="input"):(t=o("button"),t.type="button",t.className="btn",t.innerHTML=i.html,t.action_cmd=i.cmd),t.addEventListener(r,(()=>i.cmd(t))),i.hint=n("EDITOR/"+v.toUpperCase()),i.hint?t.title=i.key?i.hint+" ("+a+i.key+")":i.hint:i.key&&(t.title=a+i.key),t.dataset.action=v,t.tabIndex=-1,i.input=t,e.append(t)}e.children.length&&f.append(e)}this.modeSelect=s.mode.plain.input;let N=s.changes;N.undo.input.disabled=N.redo.input.disabled=!0,g.addEventListener("undoStateChange",(e=>{N.undo.input.disabled=!e.canUndo,N.redo.input.disabled=!e.canRedo})),s.font.fontSize.input.selectedIndex=s.font.fontSize.defaultValueIndex,t.append(f,u,l);const C=e=>e.trim().replace(/(^["']*|["']*$)/g,"").trim().toLowerCase(),_=Object.values(s.font.fontFamily.input.options).map((e=>e.value.toLowerCase()));let T=0;const L=getComputedStyle(g.getRoot()).fontFamily.split(",").map(C);_.some(((e,t)=>{const n=e.split(",").some((e=>{const t=C(e);return L.some((e=>e===t))}));return n&&(T=t),n}));const x={},k=(e,t)=>{e.split(",").forEach((e=>{const n=C(e);void 0===x[n]&&(x[n]=t)}))};k(_[T],T),_.forEach(((e,t)=>{t!==T&&k(e,t)})),g.addEventListener("pathChange",(e=>{const t=g.getRoot();if(c(s,(n=>{c(n,(n=>{n.matches&&n.input.classList.toggle("active",e.element&&e.element.closestWithin(n.matches,t))}))})),e.element){let n=s.font.fontSize.defaultValueIndex,a=T,o=e.element,i=!1,r=!1;do{if(!i&&o.style.fontFamily){i=!0,a=-1;const e=o.style.fontFamily.split(",");for(let t=0;t<e.length;t++){const n=x[C(e[t])];if(void 0!==n){a=n;break}}}!r&&o.style.fontSize&&(r=!0,n=s.font.fontSize.select.indexOf(o.style.fontSize)),o=o.parentElement}while((!i||!r)&&o&&o!==t);s.font.fontFamily.input.selectedIndex=a,s.font.fontSize.input.selectedIndex=n}})),this.plugins={plain:!0},this.focusManager={hasFocus:()=>g._isFocused,blur:()=>g.blur()}}doAction(e){this.squire[e](),this.squire.focus()}doList(e){let t=this.squire.getSelectionClosest("UL,OL")?.nodeName;t==e?this.squire.removeList():this.squire[{UL:"makeUnorderedList",OL:"makeOrderedList"}[e]]()}setMode(e){if(this.mode!=e){let t=this.container.classList,n="source"==this.mode;t.remove("squire-mode-"+this.mode),"plain"==e?this.plain.value=s(n?this.plain.value:this.squire.getHTML()):"source"==e?this.plain.value=this.squire.getHTML():(this.setData(n?this.plain.value:l(this.plain.value)),e="wysiwyg"),this.mode=e,t.add("squire-mode-"+e),this.onModeChange?.(),setTimeout((()=>this.focus()),1)}this.modeSelect.selectedIndex="plain"==this.mode?1:0}on(e,t){"mode"==e?this.onModeChange=t:(this.squire.addEventListener(e,t),this.plain.addEventListener(e,t))}execCommand(e,t){if("insertSignature"==e)if((t=Object.assign({clearCache:!1,isHtml:!1,insertBefore:!1,signature:""},t)).clearCache)this._prev_txt_sig=null;else try{const e=t.isHtml?s(t.signature):t.signature;if("plain"===this.mode){let n=this.plain.value,a=this._prev_txt_sig;a&&(n=n.replace(a,"").trim()),this.plain.value=t.insertBefore?"\n\n"+e+"\n\n"+n:n+"\n\n"+e}else{const e=this.squire.getRoot(),n=o("br"),a=o("div");a.className="rl-signature",a.innerHTML=t.isHtml?t.signature:l(t.signature),e.querySelectorAll("div.rl-signature").forEach((e=>e.remove())),t.insertBefore?e.prepend(a):e.append(a),a.before(n),a.before(n.cloneNode())}this._prev_txt_sig=e}catch(e){}}getData(){return"source"==this.mode?this.plain.value:r(this.squire.getHTML())}setData(e){const t=this.squire;t.setHTML(r(e));const n=t.getRoot(),a=t.getSelection();a.setStart(n,0),a.setEnd(n,0),t.setSelection(a)}focus(){"plain"==this.mode?(this.plain.focus(),this.plain.setSelectionRange(0,0)):this.squire.focus()}}})(document);
