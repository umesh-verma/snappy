!function(){"use strict";const e=-2,t=-1,s=1,i=0,a={RequestError:1,RequestAborted:2,RequestTimeout:3,InvalidToken:101,AuthError:102,ConnectionError:104,DomainNotAllowed:109,AccountNotAllowed:110,ContactsSyncError:140,CantGetMessageList:201,CantGetMessage:202,CantDeleteMessage:203,CantMoveMessage:204,CantCopyMessage:205,CantSaveMessage:301,CantSendMessage:302,InvalidRecipients:303,CantSaveFilters:351,CantGetFilters:352,CantActivateFiltersScript:353,CantDeleteFiltersScript:354,CantCreateFolder:400,CantRenameFolder:401,CantDeleteFolder:402,CantSubscribeFolder:403,CantUnsubscribeFolder:404,CantDeleteNonEmptyFolder:405,DomainAlreadyExists:601,DemoSendMessageError:750,DemoAccountError:751,AccountAlreadyExists:801,AccountDoesNotExist:802,AccountSwitchFailed:803,MailServerError:901,ClientViewError:902,InvalidInputArgument:903,JsonFalse:950,JsonParse:952,UnknownNotification:998,UnknownError:999,CantInstallPackage:701,CantDeletePackage:702,InvalidPluginPackage:703,UnsupportedPluginPackage:704,CantSavePluginSettings:705},o=Array.isArray,r=e=>o(e)&&e.length,n=e=>"function"==typeof e,l=e=>null!=e?""+e:"",c=(e,t)=>Object.entries(e).forEach((([e,s])=>t(e,s))),d=(e,t=0)=>(e=parseInt(e,10),isNaN(e)||!isFinite(e)?t:e),h=(e,t)=>t&&void 0!==t.disabled&&e?.classList.toggle("disabled",e.disabled=t.disabled);let m="all";const u="Menu",p=document,g=p.documentElement.classList,b=e=>p.getElementById(e),S=b("rl-app"),v=rl.settings,A=v.get,w=e=>e&&!!(A("Capa")||{})[e],f=ko.observable(!1).extend({rateLimit:0}),P=ko.observable(!1),k=()=>P(!P()),E=(e,t)=>{let s=p.createElement(e);return t&&Object.entries(t).forEach((([e,t])=>s.setAttribute(e,t))),s},_=(e,t,s)=>dispatchEvent(new CustomEvent(e,{detail:t,cancelable:!!s})),C=ko.observable("all"),T=e=>{if(!e)return m;u!==e&&(m=e,f()&&(e=u)),C(e),shortcuts.setScope(e)};f.subscribe((e=>{e?T(u):u===shortcuts.getScope()&&T(m)})),P.subscribe((e=>g.toggle("rl-left-panel-disabled",e)));const L=p.location.pathname.replace(/\/+$/,"")+"/",y=()=>rl.adminArea()&&!v.app("adminHost"),D=()=>L+"?"+(y()?v.app("adminPath"):""),M="&q[]=",V={language:ko.observable(""),languages:ko.observableArray(),userLanguage:ko.observable(""),hourCycle:ko.observable(""),populate:function(){const e=v.app("languages");this.languages(o(e)?e:[]),this.language(A("language")),this.userLanguage(A("userLanguage")),this.hourCycle(A("hourCycle"))}};let R={};const N=()=>{if(rl.I18N)return R=rl.I18N,rl.I18N=null,p.documentElement.dir=R.LANG_DIR,1},x=e=>{let t=(s=a,i=e,Object.keys(s).find((e=>s[e]===i)));var s,i;return t?R.NOTIFICATIONS[(e=>e.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase())(t).replace("_NOTIFICATION","_ERROR")]:""},I=ko.observable(!1),O=(e,t,s)=>{let i=null==s?e:s,a=e.split("/");return R[a[0]]&&a[1]&&(i=R[a[0]][a[1]]||i),t&&c(t,((e,t)=>{i=i.replace("%"+e+"%",t)})),i},U=e=>setTimeout((()=>e.querySelectorAll("[data-i18n]").forEach((e=>{const t=e.dataset.i18n;if("["===t[0])switch(t.slice(1,6)){case"html]":e.innerHTML=O(t.slice(6));break;case"place":e.placeholder=O(t.slice(13));break;case"title":e.title=O(t.slice(7))}else e.textContent=O(t)}))),1),H=(e,t="",s=0)=>(e=d(e),a.ClientViewError===e&&t?t:x(e)||x(d(s))||""),F=(e,t)=>new Promise(((s,i)=>{const a=E("script");a.onload=()=>{N()&&(U(p),I(!I())),a.remove(),s()},a.onerror=()=>i(new Error("Language "+e+" failed")),a.src=L+"?/Lang/0/"+(t?"Admin":"App")+"/"+encodeURI(e)+"/"+v.app("version")+"/",p.head.append(a)})),q=(e,t=!1)=>O("LANGS_NAMES"+(!0===t?"_EN":"")+"/"+e,null,e);N();const B=(e,t)=>t?setTimeout((()=>e.setAttribute("data-rainloopErrorTip",t)),100):e.removeAttribute("data-rainloopErrorTip"),z=e=>ko.computed(e,{pure:!0}),G=(e,t)=>c(t,((t,s)=>e[t]||(e[t]=ko.observable(s)))),Q=(e,t)=>c(t,((t,s)=>e[t]=z(s))),W=(e,t)=>c(t,((t,s)=>e[t].subscribe(s))),$=e=>n(e?.dispose)&&e.dispose(),j=(e,t,s,i,a)=>{let o=t=>{e==t.key&&s().call(a)};t.addEventListener("keydown",o),ko.utils.domNodeDisposal.addDisposeCallback(t,(()=>t.removeEventListener("keydown",o)))};Object.assign(ko.bindingHandlers,{tooltipErrorTip:{init:(e,t)=>{p.addEventListener("click",(()=>{let s=t();ko.isObservable(s)&&!ko.isComputed(s)&&s(""),B(e)}))},update:(e,t)=>{let s=ko.unwrap(t());s=n(s)?s():s,B(e,s)}},onEnter:{init:(e,t,s,i)=>j("Enter",e,t,0,i)},onEsc:{init:(e,t,s,i)=>j("Escape",e,t,0,i)},onSpace:{init:(e,t,s,i)=>j(" ",e,t,0,i)},i18nUpdate:{update:(e,t)=>{ko.unwrap(t()),U(e)}},title:{update:(e,t)=>e.title=ko.unwrap(t())},command:{init:(e,t,s,i,a)=>{const o=t();if(!o||!o.canExecute)throw new Error("Value should be a command");ko.bindingHandlers["FORM"==e.nodeName?"submit":"click"].init(e,t,s,i,a)},update:(e,t)=>{const s=e.classList;let i=!t().canExecute();s.toggle("disabled",i),e.matches("INPUT,TEXTAREA,BUTTON")&&(e.disabled=i)}},saveTrigger:{init:e=>{let t=e;e.matches("input,select,textarea")&&(e.classList.add("settings-save-trigger-input"),e.after(e.saveTriggerIcon=t=E("span"))),t.classList.add("settings-save-trigger")},update:(t,a)=>{const o=parseInt(ko.unwrap(a()),10);let r=(t.saveTriggerIcon||t).classList;t.saveTriggerIcon&&(r.toggle("saving",o===e),r.toggle("success",o===s),r.toggle("error",o===i)),r=t.classList,r.toggle("success",o===s),r.toggle("error",o===i)}}}),ko.extenders.toggleSubscribeProperty=(e,t)=>{const s=t[1];return s&&(e.subscribe((e=>e?.[s]?.(!1)),t[0],"beforeChange"),e.subscribe((e=>e?.[s]?.(!0)),t[0])),e},ko.extenders.falseTimeout=(e,t)=>(e.subscribe((()=>e(!1)).debounce(parseInt(t,10)||0)),e),ko.observable.fn.askDeleteHelper=function(){return this.extend({falseTimeout:3e3,toggleSubscribeProperty:[this,"askDelete"]})};let J=0;const Y=matchMedia("(max-width: 799px)"),K={theme:ko.observable(""),themes:ko.observableArray(),userBackgroundName:ko.observable(""),userBackgroundHash:ko.observable(""),fontSansSerif:ko.observable(""),fontSerif:ko.observable(""),fontMono:ko.observable(""),isMobile:ko.observable(!1)},Z=()=>{const e=A("Theme"),t=v.app("themes");K.themes(o(t)?t:[]),K.theme(e),X(e),K.isMobile()||(K.userBackgroundName(A("userBackgroundName")),K.userBackgroundHash(A("userBackgroundHash"))),K.fontSansSerif(A("fontSansSerif")),K.fontSerif(A("fontSerif")),K.fontMono(A("fontMono")),P(K.isMobile())},X=(i,a=(()=>0))=>{const o=b("app-theme-style"),n=()=>{J=setTimeout((()=>a(t)),1e3)},l=L+"?/Css/0/User/-/"+encodeURI(i)+"/-/"+Date.now()+"/Hash/-/Json/";o.dataset.name!=i&&(clearTimeout(J),a(e),rl.app.Remote.abort("theme").get("theme",l).then((e=>{2===r(e)&&(o.textContent=e[1],o.dataset.name=i,a(s)),n()}),n))},ee=e=>e.replace(/@[a-z]+$/,"").replace(/([A-Z])/g," $1").trim();W(K,{fontSansSerif:e=>{if(null!=e){let t=S.classList;t.forEach((e=>{e.startsWith("font")&&!/font(Serif|Mono)/.test(e)&&t.remove(e)})),e&&t.add("font"+e)}},fontSerif:e=>{if(null!=e){let t=S.classList;t.forEach((e=>e.startsWith("fontSerif")&&t.remove(e))),e&&t.add("fontSerif"+e)}},fontMono:e=>{if(null!=e){let t=S.classList;t.forEach((e=>e.startsWith("fontMono")&&t.remove(e))),e&&t.add("fontMono"+e)}},userBackgroundHash:e=>{var t,s;S.classList.toggle("UserBackground",!!e),S.style.backgroundImage=e?"url("+(s=e,L+"?/Raw/"+M+"/0/"+((t="UserBackground")?t+"/"+(s?M+"/"+s:""):"")+")"):null}}),Y.onchange=e=>{K.isMobile(e.matches),g.toggle("rl-mobile",e.matches),P(e.matches)},Y.onchange(Y);let te=0;const se=(e="")=>{return t="Json",D()+"/"+t+"/"+M+"/0/"+l(e);var t},ie=e=>{const t=e?e.ErrorCode:null;(a.InvalidToken===t||[a.AuthError,a.ConnectionError,a.DomainNotAllowed,a.AccountNotAllowed,a.MailServerError,a.UnknownNotification,a.UnknownError].includes(t)&&7<++te)&&rl.logoutReload()},ae={},oe=(e,t,s)=>{let i=ae[e];ae[e]=null,i&&(clearTimeout(i.timeoutId),s||i.abort(t||"AbortError"))},re=(e,t,s,i,a)=>{s&&(s instanceof FormData?s.set("Action",e):s.Action=e);const o=new AbortController,r=o.signal;return ae[e]=o,o.timeoutId=i&&setTimeout((()=>oe(e,"TimeoutError")),i),rl.fetchJSON(t,{signal:r},s).then((t=>(oe(e,0,1),a?a(t):Promise.resolve(t)))).catch((e=>(clearTimeout(o.timeoutId),e.aborted=r.aborted,e.reason=r.reason,Promise.reject(e))))};class FetchError extends Error{constructor(e,t){super(t),this.code=e||a.JsonFalse}}class AbstractFetchRemote{abort(e,t){return oe(e,t),this}streamPerLine(e,t,s){rl.fetch(se(t),{},s).then((e=>e.body)).then((t=>{let s="";const i=t.getReader(),a=/\r\n|\n|\r/gm,o=new TextDecoder,r=({done:t,value:n})=>{for(s+=n?o.decode(n,{stream:!0}):"";;){let o=a.exec(s);if(!o){if(t)break;return void i.read().then(r)}e(s.slice(0,o.index)),s=s.slice(o.index+1),a.lastIndex=0}s.length&&e(s)};i.read().then(r)}))}request(e,t,s,i,o){s=s||{};const r=Date.now();re(e,se(o),o?null:s||{},void 0===i?3e4:d(i),(e=>{let s=0;e&&(e.Result?te=0:(ie(e),s=e.ErrorCode||a.UnknownError)),t&&t(s,e,e?.epoch&&e.epoch<Math.floor(r/1e3)-60)})).catch((e=>{t&&t("TimeoutError"==e.reason?3:"AbortError"==e.name?2:1,e)}))}getPublicKey(e){this.request("GetPublicKey",e)}setTrigger(e,t){e&&(t=!!t,(o(e)?e:[e]).forEach((e=>{e?.(t)})))}get(e,t){return re(e,t)}post(e,t,s,i){return this.setTrigger(t,!0),re(e,se(),s||{},d(i,3e4),(s=>(oe(e,0,1),s?(this.setTrigger(t,!1),s.Result&&e===s.Action?s:(ie(s),Promise.reject(new FetchError(s?s.ErrorCode:0,s?s.ErrorMessageAdditional||s.ErrorMessage:"")))):Promise.reject(new FetchError(a.JsonParse)))))}}Object.assign(AbstractFetchRemote.prototype,{SUCCESS:0,ERROR:1,ABORT:2});var ne=new class RemoteAdminFetch extends AbstractFetchRemote{saveSetting(e,t,s){this.request("AdminSettingsUpdate",s,{[e]:t})}};class AbstractScreen{constructor(e,t=[]){this.__cross=null,this.screenName=e,this.viewModels=o(t)?t:[]}routes(){return null}onStart(){const e=this.routes();if(r(e)){let t=new Crossroads,s=(this.onRoute||(()=>0)).bind(this);e.forEach((e=>e&&(t.addRoute(e[0],s).rules=e[1]))),this.__cross=t}}}const le=[];class AbstractSettingsScreen extends AbstractScreen{constructor(e){super("settings",e),this.menu=ko.observableArray(),this.oCurrentSubScreen=null}onRoute(e){let t=null,s=null,i=le.find((t=>e===t.route));if(i){const e=this.viewModels[1].__dom,a=i.vmc;a.__vm?(t=a.__vm,s=t.viewModelDom):e&&(s=E("div",{id:"V-Settings-"+a.name.replace(/(User|Admin)Settings/,""),hidden:""}),e.append(s),t=new a,t.viewModelDom=s,t.viewModelTemplateID=i.template,a.__dom=s,a.__vm=t,_("rl-view-model.create",t),ko.applyBindingAccessorsToNode(s,{template:()=>({name:i.template})},t),t.onBuild?.(s),_("rl-view-model",t)),t&&setTimeout((()=>{this.onHide(),this.oCurrentSubScreen=t,t.beforeShow?.(),U(s),s.hidden=!1,t.onShow?.(),this.menu.forEach((e=>{e.selected(e.route===i.route)})),(e||{}).scrollTop=0}),1)}else hasher.replaceHash(((e="")=>"#/settings"+(e?"/"+e:""))())}onHide(){let e=this.oCurrentSubScreen;e&&(e.onHide?.(),e.viewModelDom.hidden=!0)}onBuild(){le.forEach((e=>this.menu.push(e)))}routes(){const e=le.find((e=>e.isDefault)),t=e?.route||"general",s={subname:/^(.*)$/,normalize_:(e,s)=>(s.subname=null==s.subname?t:l(s.subname),[s.subname])};return[["{subname}/",s],["{subname}",s],["",s]]}}function ce(e,t,s,i,a=!1){let o=e.name.replace(/(User|Admin)Settings/,"");le.push({vmc:e,label:s||"SETTINGS_LABELS/"+o.toUpperCase(),route:i||o.toLowerCase(),selected:ko.observable(!1),template:t||e.name,isDefault:!!a})}let de=null,he="";const me=new Map,ue=e=>e.querySelector("[autofocus]")?.focus(),pe=new Set,ge=e=>e&&me.get(e)||null,be=(e,t)=>{if(e&&!e.__builded){let s=null;const i=new e(t),a=i.viewModelTemplateID,o="rl-"+i.viewType,r=we===i.viewType,n=p.getElementById(o);if(e.__builded=!0,e.__vm=i,n){if(s=r?E("dialog",{id:"V-"+a}):E("div",{id:"V-"+a,hidden:""}),n.append(s),i.viewModelDom=e.__dom=s,r){s.showModal||(s.className="polyfill",s.showModal=()=>{s.backdrop||s.before(s.backdrop=E("div",{class:"dialog-backdrop"})),s.setAttribute("open",""),s.open=!0,s.returnValue=null,s.backdrop.hidden=!1},s.close=e=>{s.backdrop.hidden=!0,s.returnValue=e,s.removeAttribute("open",null),s.open=!1});const e=e=>{e.target===s&&(s.classList.contains("animate")?i.afterShow?.():(s.close(),i.afterHide?.()))};i.modalVisible.subscribe((e=>{e?(U(s),pe.add(i),s.style.zIndex=3001+2*pe.size,s.showModal(),s.backdrop&&(s.backdrop.style.zIndex=3e3+2*pe.size),i.keyScope.set(),setTimeout((()=>ue(s)),1),requestAnimationFrame((()=>{s.offsetHeight,s.classList.add("animate")}))):(pe.delete(i),i.onHide?.(),i.keyScope.unset(),s.classList.remove("animate")),Pe(0<pe.size)})),s.addEventListener("transitionend",e)}_("rl-view-model.create",i),ko.applyBindingAccessorsToNode(s,{template:()=>({name:a})},i),i.onBuild?.(s),_("rl-view-model",i)}}return e?.__vm},Se=(e,t)=>{e.viewModels.forEach((e=>{e.__vm&&e.__dom&&we!==e.__vm.viewType&&t(e.__vm,e.__dom)}))},ve=(e,t)=>{e.onHide?.(),Se(e,((e,s)=>{s.hidden=!0,e.onHide?.(),t&&e.viewModelDom.remove()})),K.isMobile()&&P(!0)},Ae=(e,t)=>{if((e=e||he)&&_("sm-show-screen",e,1)){for(let e of pe)!1===e.onClose()||e.close();let s=ge(e);if(s||(s=ge(he),s&&(t=e+"/"+t,e=he)),s?.__started){let e=de&&s===de;s.__builded||(s.__builded=!0,s.viewModels.forEach((e=>be(e,s))),s.onBuild?.()),setTimeout((()=>{de&&!e&&ve(de),de=s,e||(s.onShow?.(),Se(s,((e,t)=>{e.beforeShow?.(),U(t),t.hidden=!1,e.onShow?.(),ue(t)}))),s.__cross?.parse(t)}),1)}}},we="popups",fe=(e,t=[])=>{const s=be(e)&&e.__dom&&e.__vm;s&&(t=t||[],s.beforeShow?.(...t),s.modalVisible(!0),s.onShow?.(...t))},Pe=ko.observable(!1),ke=e=>{hasher.clear(),me.forEach((e=>ve(e,1))),me.clear(),de=null,he="",e.forEach((e=>{const t=new e,s=t.screenName;he||(he=s),me.set(s,t)})),me.forEach((e=>{e.__started||(e.onStart(),e.__started=!0)}));const t=new Crossroads;t.addRoute(/^([^/]*)\/?(.*)$/,Ae),hasher.add(t.parse.bind(t)),hasher.init(),setTimeout((()=>g.remove("rl-started-trigger")),100);const s=b("rl-content"),i=b("rl-loading");s&&(s.hidden=!1),i?.remove()},Ee=(e,t)=>c(t,((t,s)=>{let i=e[t],a=(...t)=>a.canExecute()&&i.apply(e,t);a.canExecute=z((()=>s.call(e,e))),e[t]=a}));ko.decorateCommands=Ee;class AbstractView{constructor(e,t){this.viewModelTemplateID=e||this.constructor.name.replace("UserView",""),this.viewType=t,this.viewModelDom=null,this.keyScope={scope:"none",previous:"none",set:function(){this.previous=T(),T(this.scope)},unset:function(){T(this.previous)}}}querySelector(e){return this.viewModelDom.querySelector(e)}addObservables(e){G(this,e)}addComputables(e){Q(this,e)}addSubscribables(e){W(this,e)}}class AbstractViewPopup extends AbstractView{constructor(e){super("Popups"+e,we),this.keyScope.scope=e,this.modalVisible=ko.observable(!1).extend({rateLimit:0}),this.close=()=>this.modalVisible(!1),((...e)=>{shortcuts.add(...e)})("escape,close","",e,(()=>(this.modalVisible()&&!1!==this.onClose()&&this.close(),!1)))}onClose(){}}AbstractViewPopup.showModal=function(e=[]){fe(this,e)},AbstractViewPopup.hidden=function(){return!this.__vm||!this.__vm.modalVisible()};class AbstractViewLeft extends AbstractView{constructor(e){super(e,"left"),this.leftPanelDisabled=P,this.toggleLeftPanel=k}}class AbstractViewRight extends AbstractView{constructor(e){super(e,"right")}}class AbstractViewSettings{addSetting(a,o){let r=a[0].toLowerCase()+a.slice(1),n=r+"Trigger";G(this,{[r]:A(a),[n]:t}),W(this,{[r]:(r=>{this[n](e),o?.(r),rl.app.Remote.saveSetting(a,r,(e=>{this[n](e?i:s),setTimeout((()=>this[n](t)),1e3)}))}).debounce(999)})}addSettings(e){e.forEach((e=>{let t=e[0].toLowerCase()+e.slice(1);this[t]||(this[t]=ko.observable(A(e))),this[t].subscribe((t=>rl.app.Remote.saveSetting(e,t)))}))}}class AbstractViewLogin extends AbstractView{constructor(e){super(e,"content"),this.formError=ko.observable(!1).extend({falseTimeout:500})}onBuild(e){e.classList.add("LoginView")}onShow(){b("rl-left").hidden=!0,b("rl-right").hidden=!0,rl.route.off()}onHide(){b("rl-left").hidden=!1,b("rl-right").hidden=!1}submitForm(){}}const _e=[],Ce=[];rl.pluginRemoteRequest=(e,t,s,i)=>{rl.app.Remote.request("Plugin"+t,e,s,i)},rl.addSettingsViewModel=(e,t,s,i)=>{_e.push([e,t,s,i])},rl.addSettingsViewModelForAdmin=(e,t,s,i)=>{Ce.push([e,t,s,i])},rl.pluginSettingsGet=(e,t)=>A("Plugins")?.[e]?.[t],rl.pluginPopupView=AbstractViewPopup;class LanguagesPopupView extends AbstractViewPopup{constructor(){super("Languages"),this.fLang=null,this.languages=ko.observableArray()}onShow(e,t,s){this.fLang=e,this.languages(t.map((t=>({key:t,user:s===t,selected:e?.()===t,fullName:q(t),title:q(t,!0)}))))}changeLanguage(e){this.fLang?.(e),this.close()}}class AdminSettingsGeneral extends AbstractViewSettings{constructor(){super(),this.language=V.language,this.languages=V.languages;const a=v.app("languagesAdmin");this.languagesAdmin=ko.observableArray(o(a)?a:[]),this.languageAdmin=ko.observable(A("languageAdmin")),this.theme=K.theme,this.themes=K.themes,this.addSettings(["allowLanguagesOnSettings"]),G(this,{capaThemes:w("Themes"),capaUserBackground:w("UserBackground"),capaAdditionalAccounts:w("AdditionalAccounts"),capaIdentities:w("Identities"),capaAttachmentThumbnails:w("AttachmentThumbnails"),dataFolderAccess:!1}),this.weakPassword=rl.app.weakPassword,this.attachmentLimit=ko.observable(A("attachmentLimit")/1048576).extend({debounce:500}),this.addSetting("language"),this.addSetting("attachmentLimit"),this.addSetting("Theme",(e=>X(e,this.themeTrigger))),this.uploadData=A("phpUploadSizes"),this.uploadDataDesc=this.uploadData?.upload_max_filesize||this.uploadData?.post_max_size?[this.uploadData.upload_max_filesize?"upload_max_filesize = "+this.uploadData.upload_max_filesize+"; ":"",this.uploadData.post_max_size?"post_max_size = "+this.uploadData.post_max_size:""].join(""):"",Q(this,{themesOptions:()=>this.themes.map((e=>({optValue:e,optText:ee(e)}))),languageFullName:()=>q(this.language()),languageAdminFullName:()=>q(this.languageAdmin())}),this.languageAdminTrigger=ko.observable(t).extend({debounce:100});const r=e=>()=>{this.languageAdminTrigger(e),setTimeout((()=>this.languageAdminTrigger(t)),1e3)},n=e=>t=>ne.saveSetting(e,t);W(this,{languageAdmin:t=>{this.languageAdminTrigger(e),F(t,1).then(r(s),r(i)).then((()=>ne.saveSetting("languageAdmin",t)))},capaAdditionalAccounts:n("CapaAdditionalAccounts"),capaIdentities:n("CapaIdentities"),capaAttachmentThumbnails:n("CapaAttachmentThumbnails"),capaThemes:n("CapaThemes"),capaUserBackground:n("CapaUserBackground")})}selectLanguage(){fe(LanguagesPopupView,[this.language,this.languages(),V.userLanguage()])}selectLanguageAdmin(){fe(LanguagesPopupView,[this.languageAdmin,this.languagesAdmin(),A("languageUsers")])}}const Te=ko.observableArray();Te.loading=ko.observable(!1),Te.fetch=()=>{Te.loading(!0),ne.request("AdminDomainList",((e,t)=>{Te.loading(!1),e||Te(t.Result.map((e=>(e.disabled=ko.observable(e.disabled),e.askDelete=ko.observable(!1),e))))}),{includeAliases:1})};class AskPopupView extends AbstractViewPopup{constructor(){super("Ask"),G(this,{askDesc:"",yesButton:"",noButton:"",username:"",askUsername:!1,passphrase:"",askPass:!1,remember:!0,askRemeber:!1}),this.fYesAction=null,this.fNoAction=null,this.focusOnShow=!0}yesClick(){this.close(),n(this.fYesAction)&&this.fYesAction(this)}noClick(){this.close(),n(this.fNoAction)&&this.fNoAction(this)}onShow(e,t=null,s=null,i=!0,a=0,o=""){this.askDesc(e||""),this.askUsername(2&a),this.askPass(1&a),this.askRemeber(4&a),this.username(""),this.passphrase(""),this.remember(!0),this.yesButton(O(o||"GLOBAL/YES")),this.noButton(O(a?"GLOBAL/CANCEL":"GLOBAL/NO")),this.fYesAction=t,this.fNoAction=s,this.focusOnShow=i?a?'input[type="'+(2&a?"text":"password")+'"]':".buttonYes":""}afterShow(){this.focusOnShow&&this.querySelector(this.focusOnShow).focus()}onClose(){return this.noClick(),!1}onBuild(){shortcuts.add("tab,arrowright,arrowleft","","Ask",(()=>{let e=this.querySelector(".buttonYes"),t=this.querySelector(".buttonNo");return e.matches(":focus")?(t.focus(),!1):t.matches(":focus")?(e.focus(),!1):void 0}))}}AskPopupView.password=function(e,t){return new Promise((s=>{this.showModal([e,e=>s({password:e.passphrase(),remember:e.remember()}),()=>s(null),!0,5,t])}))},AskPopupView.credentials=function(e,t){return new Promise((s=>{this.showModal([e,e=>s({username:e.username(),password:e.passphrase(),remember:e.remember()}),()=>s(null),!0,3,t])}))};const Le=e=>e.charAt(0).toUpperCase()+e.slice(1),ye={enableSmartPorts:!1,savingError:"",name:"",imapHost:"",imapPort:143,imapType:0,imapTimeout:300,imapShortLogin:!1,imapSslVerify_peer:!1,imapSslAllow_self_signed:!1,imapDisable_list_status:!1,imapDisable_metadata:!1,imapDisable_move:!1,imapDisable_sort:!1,imapDisable_thread:!1,imapDisable_binary:!1,imapExpunge_all_on_delete:!1,imapFast_simple_search:!0,imapFetch_new_messages:!0,imapForce_select:!1,imapFolder_list_limit:200,imapMessage_all_headers:!1,imapMessage_list_limit:0,imapSearch_filter:"",sieveEnabled:!1,sieveHost:"",sievePort:4190,sieveType:0,sieveTimeout:10,smtpHost:"",smtpPort:25,smtpType:0,smtpTimeout:60,smtpShortLogin:!1,smtpUseAuth:!0,smtpSetSender:!1,smtpAuthPlainLine:!1,smtpUsePhpMail:!1,smtpSslVerify_peer:!1,smtpSslAllow_self_signed:!1,whiteList:"",aliasName:""},De=e=>({name:e.name,IMAP:{host:e.imapHost,port:e.imapPort,secure:d(e.imapType()),timeout:e.imapTimeout,shortLogin:!!e.imapShortLogin(),ssl:{verify_peer:!!e.imapSslVerify_peer(),verify_peer_name:!!e.imapSslVerify_peer(),allow_self_signed:!!e.imapSslAllow_self_signed()},disable_list_status:!!e.imapDisable_list_status(),disable_metadata:!!e.imapDisable_metadata(),disable_move:!!e.imapDisable_move(),disable_sort:!!e.imapDisable_sort(),disable_thread:!!e.imapDisable_thread(),disable_binary:!!e.imapDisable_binary(),folder_list_limit:d(e.imapFolder_list_limit()),message_list_limit:d(e.imapMessage_list_limit())},SMTP:{host:e.smtpHost,port:e.smtpPort,secure:d(e.smtpType()),timeout:e.smtpTimeout,shortLogin:!!e.smtpShortLogin(),ssl:{verify_peer:!!e.smtpSslVerify_peer(),verify_peer_name:!!e.smtpSslVerify_peer(),allow_self_signed:!!e.smtpSslAllow_self_signed()},setSender:!!e.smtpSetSender(),authPlainLine:!!e.smtpAuthPlainLine(),useAuth:!!e.smtpUseAuth(),usePhpMail:!!e.smtpUsePhpMail()},Sieve:{enabled:!!e.sieveEnabled(),host:e.sieveHost,port:e.sievePort,secure:d(e.sieveType()),timeout:e.sieveTimeout,shortLogin:!!e.imapShortLogin(),ssl:{verify_peer:!!e.imapSslVerify_peer(),verify_peer_name:!!e.imapSslVerify_peer(),allow_self_signed:!!e.imapSslAllow_self_signed()}},whiteList:e.whiteList});class DomainPopupView extends AbstractViewPopup{constructor(){super("Domain"),G(this,ye),G(this,{edit:!1,saving:!1,testing:!1,testingDone:!1,testingImapError:!1,testingSieveError:!1,testingSmtpError:!1,imapHostFocus:!1,sieveHostFocus:!1,smtpHostFocus:!1}),Q(this,{headerText:()=>{const e=this.name(),t=this.aliasName();return this.edit()?O("POPUPS_DOMAIN/TITLE_EDIT_DOMAIN",{NAME:e})+(t?" ⫘ "+t:""):e?O("POPUPS_DOMAIN/TITLE_ADD_DOMAIN_WITH_NAME",{NAME:e}):O("POPUPS_DOMAIN/TITLE_ADD_DOMAIN")},domainDesc:()=>{const e=this.name();return!this.edit()&&e?O("POPUPS_DOMAIN/NEW_DOMAIN_DESC",{NAME:"*@"+e}):""},domainIsComputed:()=>{const e=this.smtpUsePhpMail(),t=this.sieveEnabled();return this.name()&&this.imapHost()&&this.imapPort()&&(!t||this.sieveHost()&&this.sievePort())&&(this.smtpHost()&&this.smtpPort()||e)},canBeTested:()=>!this.testing()&&this.domainIsComputed(),canBeSaved:()=>!this.saving()&&this.domainIsComputed()}),W(this,{imapHostFocus:e=>e&&this.name()&&!this.imapHost()&&this.imapHost(this.name().replace(/[.]?[*][.]?/g,"")),sieveHostFocus:e=>e&&this.imapHost()&&!this.sieveHost()&&this.sieveHost(this.imapHost()),smtpHostFocus:e=>e&&this.imapHost()&&!this.smtpHost()&&this.smtpHost(this.imapHost().replace(/imap/gi,"smtp")),imapType:e=>{if(this.enableSmartPorts()){const t=d(this.imapPort());switch(d(e)){case 0:case 2:993===t&&this.imapPort(143);break;case 1:143===t&&this.imapPort(993)}}},smtpType:e=>{if(this.enableSmartPorts()){const t=d(this.smtpPort());switch(d(e)){case 0:465!==t&&587!==t||this.smtpPort(25);break;case 1:25!==t&&587!==t||this.smtpPort(465);break;case 2:25!==t&&465!==t||this.smtpPort(587)}}}}),Ee(this,{createOrAddCommand:e=>e.canBeSaved(),testConnectionCommand:e=>e.canBeTested()})}createOrAddCommand(){this.saving(!0),ne.request("AdminDomainSave",(e=>{this.saving(!1),e?this.savingError(H(e)):(Te.fetch(),this.close())}),Object.assign(De(this),{create:this.edit()?0:1}))}testConnectionCommand(){this.clearTesting(),AskPopupView.credentials("IMAP","GLOBAL/TEST").then((e=>{if(e){this.testing(!0);const t=De(this);t.auth={user:e.username,pass:e.password},ne.request("AdminDomainTest",((e,t)=>{this.testing(!1),e?(this.testingImapError(H(e)),this.testingSieveError(H(e)),this.testingSmtpError(H(e))):(this.testingDone(!0),this.testingImapError(!0!==t.Result.Imap&&t.Result.Imap),this.testingSieveError(!0!==t.Result.Sieve&&t.Result.Sieve),this.testingSmtpError(!0!==t.Result.Smtp&&t.Result.Smtp))}),t)}}))}clearTesting(){this.testing(!1),this.testingDone(!1),this.testingImapError(!1),this.testingSieveError(!1),this.testingSmtpError(!1)}onShow(e){this.saving(!1),this.clearTesting(),this.edit(!1),c(ye,((e,t)=>this[e](t))),this.enableSmartPorts(!0),e&&(this.enableSmartPorts(!1),this.edit(!0),c(e,((e,t)=>{"IMAP"===e||"SMTP"===e||"Sieve"===e?(e=e.toLowerCase(),c(t,((t,s)=>{"Ssl"==(t=Le(t))?c(s,((s,i)=>{this[e+t+Le(s)]?.(i)})):this[e+t]?.(s)}))):this[e]?.(t)})),this.enableSmartPorts(!0))}}class DomainAliasPopupView extends AbstractViewPopup{constructor(){super("DomainAlias"),G(this,{saving:!1,savingError:"",name:"",alias:""}),Q(this,{domains:()=>Te.filter((e=>e&&!e.alias)),domainsOptions:()=>this.domains().map((e=>({optValue:e.name,optText:e.name}))),canBeSaved:()=>!this.saving()&&this.name()&&this.alias()}),Ee(this,{createCommand:e=>e.canBeSaved()})}createCommand(){this.saving(!0),ne.request("AdminDomainAliasSave",(e=>{this.saving(!1),e?this.savingError(H(e)):(Te.fetch(),this.close())}),{name:this.name,alias:this.alias})}onShow(){this.saving(!1),this.savingError(""),this.name(""),this.alias("")}}class AdminSettingsDomains{constructor(){this.domains=Te,this.username=ko.observable(""),this.domainForDeletion=ko.observable(null).askDeleteHelper()}testUsername(){ne.request("AdminDomainMatch",((e,t)=>{t?.Result?.domain?alert(`${t.Result.email} matched domain: ${t.Result.domain.name}`):alert("No domain match")}),{username:this.username})}createDomain(){fe(DomainPopupView)}createDomainAlias(){fe(DomainAliasPopupView)}deleteDomain(e){Te.remove(e),ne.request("AdminDomainDelete",Te.fetch,{name:e.name})}disableDomain(e){e.disabled(!e.disabled()),ne.request("AdminDomainDisable",Te.fetch,{name:e.name,disabled:e.disabled()?1:0})}onBuild(e){e.addEventListener("click",(t=>{let s=t.target.closestWithin(".b-admin-domains-list-table .e-action",e);s&&ko.dataFor(s)&&ne.request("AdminDomainLoad",((e,t)=>e||fe(DomainPopupView,[t.Result])),{name:ko.dataFor(s).name})})),Te.fetch()}}class AdminSettingsLogin extends AbstractViewSettings{constructor(){super(),this.addSetting("loginDefaultDomain"),this.addSettings(["determineUserLanguage","determineUserDomain","allowLanguagesOnLogin"])}}class AdminSettingsContacts extends AbstractViewSettings{constructor(){super(),this.defaultOptionsAfterRender=h,this.addSetting("contactsPdoDsn"),this.addSetting("contactsPdoUser"),this.addSetting("contactsPdoPassword"),this.addSetting("contactsPdoType",(()=>{this.testContactsSuccess(!1),this.testContactsError(!1),this.testContactsErrorMessage("")})),this.addSettings(["contactsEnable","contactsSync"]),this.addSetting("contactsMySQLSSLCA"),this.addSetting("contactsMySQLSSLVerify"),this.addSetting("contactsMySQLSSLCiphers"),G(this,{testing:!1,testContactsSuccess:!1,testContactsError:!1,testContactsErrorMessage:""}),this.addSetting("contactsSuggestionsLimit");const e=A("supportedPdoDrivers")||[],t=[{id:"sqlite",name:"SQLite"},{id:"mysql",name:"MySQL"},{id:"pgsql",name:"PostgreSQL"}].filter((t=>e.includes(t.id)));this.contactsSupported=0<t.length,this.contactsTypesOptions=t,this.mainContactsType=ko.computed({read:this.contactsPdoType,write:s=>{s!==this.contactsPdoType()?e.includes(s)?this.contactsPdoType(s):t.length&&this.contactsPdoType(""):this.contactsPdoType.valueHasMutated()}}).extend({notify:"always"}),Ee(this,{testContactsCommand:e=>e.contactsPdoDsn()&&e.contactsPdoUser()})}testContactsCommand(){this.testContactsSuccess(!1),this.testContactsError(!1),this.testContactsErrorMessage(""),this.testing(!0),ne.request("AdminContactsTest",((e,t)=>{this.testContactsSuccess(!1),this.testContactsError(!1),this.testContactsErrorMessage(""),!e&&t.Result.Result?this.testContactsSuccess(!0):(this.testContactsError(!0),this.testContactsErrorMessage(t?.Result?.Message||"")),this.testing(!1)}),{PdoType:this.contactsPdoType(),PdoDsn:this.contactsPdoDsn(),PdoUser:this.contactsPdoUser(),PdoPassword:this.contactsPdoPassword(),MySQLSSLCA:this.contactsMySQLSSLCA(),MySQLSSLVerify:this.contactsMySQLSSLVerify(),MySQLSSLCiphers:this.contactsMySQLSSLCiphers()})}onShow(){this.testContactsSuccess(!1),this.testContactsError(!1),this.testContactsErrorMessage("")}}class AdminSettingsSecurity extends AbstractViewSettings{constructor(){super(),this.addSettings(["useLocalProxyForExternalImages"]),this.weakPassword=rl.app.weakPassword,G(this,{adminLogin:A("adminLogin"),adminLoginError:!1,adminPassword:"",adminPasswordNew:"",adminPasswordNew2:"",adminPasswordNewError:!1,adminTOTP:"",saveError:!1,saveSuccess:!1,viewQRCode:"",capaOpenPGP:w("OpenPGP")});const e=()=>{this.saveError(!1),this.saveSuccess(!1),this.adminPasswordNewError(!1)};W(this,{adminPassword:()=>{this.saveError(!1),this.saveSuccess(!1)},adminLogin:()=>this.adminLoginError(!1),adminTOTP:e=>{/[A-Z2-7]{16,}/.test(e)&&0==5*e.length%8?ne.request("AdminQRCode",((e,t)=>{e||this.viewQRCode(t.Result)}),{username:this.adminLogin(),TOTP:this.adminTOTP()}):this.viewQRCode("")},adminPasswordNew:e,adminPasswordNew2:e,capaOpenPGP:e=>ne.saveSetting("CapaOpenPGP",e)}),this.adminTOTP(A("adminTOTP")),Ee(this,{saveAdminUserCommand:e=>e.adminLogin().trim()&&e.adminPassword()})}saveAdminUserCommand(){return this.adminLogin().trim()?this.adminPasswordNew()!==this.adminPasswordNew2()?(this.adminPasswordNewError(!0),!1):(this.saveError(!1),this.saveSuccess(!1),ne.request("AdminPasswordUpdate",((e,t)=>{e?this.saveError(!0):(this.adminPassword(""),this.adminPasswordNew(""),this.adminPasswordNew2(""),this.saveSuccess(!0),this.weakPassword(!!t.Result.Weak))}),{Login:this.adminLogin(),Password:this.adminPassword(),newPassword:this.adminPasswordNew(),TOTP:this.adminTOTP()}),!0):(this.adminLoginError(!0),!1)}onHide(){this.adminPassword(""),this.adminPasswordNew(""),this.adminPasswordNew2("")}}const Me=ko.observableArray();Me.real=ko.observable(!0),Me.loading=ko.observable(!1),Me.error=ko.observable(""),Me.fetch=()=>{Me.loading(!0),ne.request("AdminPackagesList",((e,t)=>{if(Me.loading(!1),e)Me.real(!1),Me.error(H(e));else{Me.real(!!t.Result.Real),Me.error(t.Result.Error);const e={};Me.forEach((t=>{t?.loading()&&(e[t.file]=t)}));let s=[];o(t.Result.List)&&(s=t.Result.List.filter((e=>e)).map((t=>(t.loading=ko.observable(void 0!==e[t.file]),t.enabled=ko.observable(t.enabled),t)))),Me(s)}}))};class PluginPopupView extends AbstractViewPopup{constructor(){super("Plugin"),G(this,{saveError:"",id:"",name:"",readme:""}),this.config=ko.observableArray(),Q(this,{hasReadme:()=>!!this.readme(),hasConfiguration:()=>0<this.config().length}),this.keyScope.scope="all",Ee(this,{saveCommand:e=>e.hasConfiguration()})}hideError(){this.saveError("")}saveCommand(){const e={id:this.id,settings:{}},t=t=>{let s=t.value();!1!==s&&!0!==s||(s=s?1:0),e.settings[t.name]=s};this.config.forEach((e=>{7==e.type?e.config.forEach((e=>t(e))):t(e)})),this.saveError(""),ne.request("AdminPluginSettingsUpdate",(e=>e?this.saveError(H(e)):this.close()),e)}onShow(e){if(this.id(""),this.name(""),this.readme(""),this.config([]),e){this.id(e.id),this.name(e.name),this.readme(e.readme);const t=e.config;r(t)&&this.config(t.map((e=>(7==e.type?e.config.forEach((e=>{e.value=ko.observable(e.value)})):e.value=ko.observable(e.value),e))))}}onClose(){return AskPopupView.hidden()&&fe(AskPopupView,[O("POPUPS_ASK/DESC_WANT_CLOSE_THIS_WINDOW"),()=>this.close()]),!1}}class AdminSettingsPackages extends AbstractViewSettings{constructor(){super(),this.addSettings(["pluginsEnable"]),G(this,{packagesError:""}),this.packages=Me,Q(this,{packagesCurrent:()=>Me().filter((e=>e?.installed&&!e.canBeUpdated)),packagesUpdate:()=>Me().filter((e=>e?.installed&&e.canBeUpdated)),packagesAvailable:()=>Me().filter((e=>!e?.installed)),visibility:()=>Me.loading()?"visible":"hidden"})}onShow(){this.packagesError("")}onBuild(e){Me.fetch(),e.addEventListener("click",(t=>{let s=t.target.closestWithin(".package-configure",e),i=s&&ko.dataFor(s);i&&ne.request("AdminPluginLoad",((e,t)=>e||fe(PluginPopupView,[t.Result])),{id:i.id}),s=t.target.closestWithin(".package-active",e),i=s&&ko.dataFor(s),i&&this.disablePlugin(i)}))}requestHelper(e,t){return(s,i)=>{Me.forEach((t=>{e&&t?.loading?.()&&e.file===t.file&&(e.loading(!1),t.loading(!1))})),s?this.packagesError(H(t?a.CantInstallPackage:a.CantDeletePackage)+(i.ErrorMessage?":\n"+i.ErrorMessage:"")):i.Result.Reload?location.reload():Me.fetch()}}deletePackage(e){e&&(e.loading(!0),ne.request("AdminPackageDelete",this.requestHelper(e,!1),{id:e.id}))}installPackage(e){e&&(e.loading(!0),ne.request("AdminPackageInstall",this.requestHelper(e,!0),{id:e.id,type:e.type,file:e.file},6e4))}disablePlugin(e){let t=e.enabled();e.enabled(!t),ne.request("AdminPluginDisable",((s,i)=>{s&&(e.enabled(t),this.packagesError(a.UnsupportedPluginPackage===s&&i?.ErrorMessage?i.ErrorMessage:H(s)))}),{id:e.id,disabled:t?1:0})}}class AdminSettingsAbout{constructor(){this.version=v.app("version"),this.phpextensions=ko.observableArray(),G(this,{coreReal:!0,coreUpdatable:!0,coreWarning:!1,coreVersion:"",coreVersionCompare:-2,load1:0,load5:0,load15:0,errorDesc:""}),this.coreChecking=ko.observable(!1).extend({throttle:100}),this.coreUpdating=ko.observable(!1).extend({throttle:100}),this.coreVersionHtmlDesc=ko.computed((()=>(I(),O("TAB_ABOUT/HTML_NEW_VERSION",{VERSION:this.coreVersion()})))),this.statusType=ko.computed((()=>{let e="";const t=this.coreVersionCompare(),s=this.coreChecking(),i=this.coreUpdating(),a=this.coreReal();return s?e="checking":i?e="updating":a?0===t?e="up-to-date":-1===t&&(e="available"):(e="error",this.errorDesc("Cannot access the repository at the moment.")),e}))}onBuild(){this.coreChecking(!0),ne.request("AdminInfo",((e,t)=>{this.coreChecking(!1),t=t?.Result,!e&&t?(this.load1(t.system.load?.[0]),this.load5(t.system.load?.[1]),this.load15(t.system.load?.[2]),this.phpextensions(t.php),this.coreReal(!0),this.coreUpdatable(!!t.core.updatable),this.coreWarning(!!t.core.warning),this.coreVersion(t.core.version||""),this.coreVersionCompare(t.core.versionCompare)):(this.coreReal(!1),this.coreWarning(!1),this.coreVersion(""),this.coreVersionCompare(-2))}))}updateCoreData(){this.coreUpdating()||(this.coreUpdating(!0),ne.request("AdminUpgradeCore",((e,t)=>{this.coreUpdating(!1),this.coreVersion(""),this.coreVersionCompare(-2),!e&&t?.Result?(this.coreReal(!0),window.location.reload()):this.coreReal(!1)}),{},9e4))}}class AdminSettingsBranding extends AbstractViewSettings{constructor(){super(),this.addSetting("title"),this.addSetting("loadingDescription"),this.addSetting("faviconUrl")}}class AdminSettingsConfig{constructor(){this.config=ko.observableArray(),this.saved=ko.observable(!1).extend({falseTimeout:5e3})}beforeShow(){ne.request("AdminSettingsGet",((e,t)=>{if(!e){const e=[],s=(e,t)=>{switch(typeof e){case"boolean":return"checkbox";case"number":return"number"}return t?"password":"text"};c(t.Result,((t,i)=>{const a={name:t,items:[]};c(i,((e,i)=>{"admin_password"===e||a.items.push({key:`config[${t}][${e}]`,name:e,value:i[0],type:s(i[0],e.includes("password")),comment:i[1]})})),e.push(a)})),this.config(e)}}))}saveConfig(e){const t=new FormData(e),s={};this.config.forEach((e=>{s[e.name]||(s[e.name]={}),e.items.forEach((i=>{let a=t.get(i.key);switch(typeof i.value){case"boolean":a="on"==a;break;case"number":a=parseInt(a,10)}s[e.name][i.name]=a}))})),ne.post("AdminSettingsSet",null,{config:s}).then((e=>{e.Result&&this.saved(!0)}))}}class MenuSettingsAdminView extends AbstractViewLeft{constructor(e){super("AdminMenu"),this.menu=e.menu}link(e){return"#/"+e}}class PaneSettingsAdminView extends AbstractViewRight{constructor(){super("AdminPane"),this.leftPanelDisabled=P,this.toggleLeftPanel=k}logoutClick(){ne.request("AdminLogout",(()=>rl.logoutReload()))}}class SettingsAdminScreen extends AbstractSettingsScreen{constructor(){super([MenuSettingsAdminView,PaneSettingsAdminView]),[AdminSettingsGeneral,AdminSettingsDomains,AdminSettingsLogin,AdminSettingsBranding,AdminSettingsContacts,AdminSettingsSecurity,AdminSettingsPackages,AdminSettingsConfig,AdminSettingsAbout].forEach(((e,t)=>ce(e,0,0,0,0===t))),(!0?Ce:_e).forEach((e=>ce(...e)))}onShow(){rl.setTitle()}}class AdminLoginView extends AbstractViewLogin{constructor(){super("AdminLogin"),G(this,{login:"",password:"",totp:"",loginError:!1,passwordError:!1,submitRequest:!1,submitError:""}),W(this,{login:()=>this.loginError(!1),password:()=>this.passwordError(!1)}),Ee(this,{submitCommand:e=>!e.submitRequest()})}hideError(){this.submitError("")}submitCommand(e,t){let s=t.target.form,i=new FormData(s),a=s.reportValidity()&&_("sm-admin-login",i,1);return this.loginError(!this.login()),this.passwordError(!this.password()),this.formError(!a),a&&(this.submitRequest(!0),ne.request("AdminLogin",((e,t)=>{_("sm-admin-login-response",{error:e,data:t}),e?(this.submitRequest(!1),this.submitError(H(e))):rl.setData(t.Result)}),i)),a}}class LoginAdminScreen extends AbstractScreen{constructor(){super("login",[AdminLoginView])}onShow(){rl.setTitle()}}class SelectComponent{constructor(e){this.value=e.value,this.label=e.label,this.trigger=e.trigger?.subscribe?e.trigger:null,this.placeholder=e.placeholder,this.options=e.options,this.optionsText=e.optionsText,this.optionsValue=e.optionsValue;let t=0<e.size?"span"+e.size:"";if(this.trigger){const e=ko.observable(""),a=t=>{switch(t){case s:e("success");break;case i:e("error");break;default:e("")}};a(this.trigger()),this.className=z((()=>(t+" settings-save-trigger-input "+e()).trim())),this.disposables=[this.trigger.subscribe(a,this),this.className]}else this.className=t;this.defaultOptionsAfterRender=h}dispose(){this.disposables?.forEach($)}}class CheckboxComponent{constructor(e={}){this.name=e.name,this.value=ko.isObservable(e.value)?e.value:ko.observable(!!e.value),this.enable=ko.isObservable(e.enable)?e.enable:ko.observable(void 0===e.enable||!!e.enable),this.label=e.label}click(){this.enable()&&this.value(!this.value())}}class AbstractApp{constructor(e){this.Remote=e}logoutReload(e){e=e||(y()?D():L),location.href!==e?setTimeout((()=>location.href=e),100):rl.route.reload()}bootstart(){const e=(e,t)=>ko.components.register(e,{template:{element:t.name},viewModel:{createViewModel:(e,s)=>(e=e||{},U(s.element),new t(e))}});var t,s;e("Select",SelectComponent),e("Checkbox",CheckboxComponent),t?.(),t&&I.subscribe(t),s&&I.subscribe(s),V.populate(),Z(),this.start()}}var Ve;Ve=new class AdminApp extends AbstractApp{constructor(){super(ne),this.weakPassword=ko.observable(!1)}refresh(){Z(),this.start()}start(){v.app("adminAllowed")?A("Auth")?(this.weakPassword(A("weakPassword")),ke([SettingsAdminScreen])):ke([LoginAdminScreen]):(rl.route.root(),setTimeout((()=>location.href="/"),1))}},rl.app=Ve,rl.logoutReload=Ve.logoutReload,rl.i18n=O,rl.Enums={StorageResultType:{Success:0,Error:1,Abort:2}},rl.route={root:()=>{rl.route.off(),hasher.setHash("#/")},reload:()=>{rl.route.root(),setTimeout((()=>location.reload()),100)},off:()=>hasher.active=!1,on:()=>hasher.active=!0}}();
